
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Nodal Analysis &#8212; Circuit Analysis</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="_static/logo.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Superposition" href="chapter-9.html" />
    <link rel="prev" title="Mesh Analysis" href="chapter-7.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Circuit Analysis</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to Circuit Analysis
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-1.html">
   Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-2.html">
   Anatomy of a Circuit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-3.html">
   Equivalent Components
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-4.html">
   Dividers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-5.html">
   A Sloppy Approach to Circuit Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-6.html">
   Review of Solving Linear Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-7.html">
   Mesh Analysis
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Nodal Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-9.html">
   Superposition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-10.html">
   Equivalent Circuits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-11.html">
   Other Passive Components
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-12.html">
   Alternating Current: Differential Equation Approach
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-13.html">
   Alternating Current: Phasors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-14.html">
   Power in Alternating Current Circuits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-15.html">
   A Simpler Approach: Complex Power
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-16.html">
   Power Factor Correction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-17.html">
   Transients in Capacitors and Inductors
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-18.html">
   More Complex Circuits using the ``Step-by-step Method’’
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chapter-19.html">
   Analyzing Circuits with Transient Signals using Differential Equations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="genindex.html">
   Index
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/Circuit-Analysis/circuit-analysis.github.io/master?urlpath=tree/./chapter-8.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/Circuit-Analysis/circuit-analysis.github.io"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/Circuit-Analysis/circuit-analysis.github.io/issues/new?title=Issue%20on%20page%20%2Fchapter-8.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/chapter-8.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download notebook file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        <a href="_sources/chapter-8.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#locating-non-reference-nodes">
   Locating Non-reference Nodes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relating-circuit-values-to-node-voltages">
   Relating Circuit Values to Node Voltages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-steps">
   The Steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#our-first-toy-problem">
   Our First Toy Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nodal-with-voltage-sources">
   Nodal with Voltage Sources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voltage-sources-connected-to-ground">
     Voltage Sources Connected to Ground
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voltage-sources-connected-to-two-non-ground-nodes">
     Voltage Sources Connected to Two Non-ground Nodes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodal-analysis-with-dependent-supplies">
     Nodal Analysis with Dependent Supplies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodal-analysis-with-an-ideal-operational-amplifier">
     Nodal Analysis with an Ideal Operational Amplifier
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-shortcut">
   The Shortcut
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strategy-for-nodal-analysis">
   Strategy for Nodal Analysis
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Nodal Analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#locating-non-reference-nodes">
   Locating Non-reference Nodes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#relating-circuit-values-to-node-voltages">
   Relating Circuit Values to Node Voltages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-steps">
   The Steps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#our-first-toy-problem">
   Our First Toy Problem
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#nodal-with-voltage-sources">
   Nodal with Voltage Sources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voltage-sources-connected-to-ground">
     Voltage Sources Connected to Ground
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#voltage-sources-connected-to-two-non-ground-nodes">
     Voltage Sources Connected to Two Non-ground Nodes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodal-analysis-with-dependent-supplies">
     Nodal Analysis with Dependent Supplies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nodal-analysis-with-an-ideal-operational-amplifier">
     Nodal Analysis with an Ideal Operational Amplifier
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-shortcut">
   The Shortcut
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strategy-for-nodal-analysis">
   Strategy for Nodal Analysis
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="nodal-analysis">
<span id="content-chapter-nodal"></span><h1>Nodal Analysis<a class="headerlink" href="#nodal-analysis" title="Permalink to this headline">#</a></h1>
<div class="cell tag_remove-input tag_remove-output docutils container">
</div>
<p>Nodal Analysis is another methodical application of KVL, KCL, and Ohm’s law that allow use to analyze any circuit. Nodal Analysis has a key advantage over Mesh Analysis but in general students become comfortable with one method or the other. The advantage Nodal Analysis has is the ease of locating the unknowns. This is true for humans and computers. Most circuit simulation software uses Nodal Analysis since it is easier to see where components connect (nodes) rather than closed paths with no intermediate branches. This becomes particularly true when analyzing circuits with ideal operational amplifiers, as we will do in this chapter.</p>
<section id="locating-non-reference-nodes">
<h2>Locating Non-reference Nodes<a class="headerlink" href="#locating-non-reference-nodes" title="Permalink to this headline">#</a></h2>
<p>if you don’t need to cross a component between two of your labeled nodes than they are, in fact, one node</p>
</section>
<section id="relating-circuit-values-to-node-voltages">
<h2>Relating Circuit Values to Node Voltages<a class="headerlink" href="#relating-circuit-values-to-node-voltages" title="Permalink to this headline">#</a></h2>
<div class="cell tag_remove-input tag_remove-output docutils container">
</div>
<div class="cell tag_remove-input tag_remove-output docutils container">
</div>
<figure class="align-default" id="nodal-example-1">
<a class="reference internal image-reference" href="_images/nodal-example-1.svg"><img alt="_images/nodal-example-1.svg" height="300px" src="_images/nodal-example-1.svg" /></a>
</figure>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div id="NLCnJvThyOeU" data-shufflequestions="False"
               data-shuffleanswers="True"
               data-preserveresponses="false"
               data-numquestions="1000000"> <style>:root {
    --medium-slate-blue: #6f78ffff;
    --orange-pantone: #f75c03ff;
    --russian-violet: #392061ff;
    --maximum-yellow-red: #ffc857ff;
    --viridian-green: #119da4ff;
    --incorrect-red: #c80202;
    --correct-green: #009113;
}

.Quiz {
    max-width: 600px;
    margin-top: 15px;
    margin-left: auto;
    margin-right: auto;
    margin-bottom: 15px;
    padding-bottom: 4px;
    padding-top: 4px;
    line-height: 1.1;
    font-size: 16pt;
}

.QuizCode {
    font-size: 14pt;
    margin-top: 10px;
    margin-left: 20px;
    margin-right: 20px;
}

.QuizCode>pre {
    padding: 4px;
}

.Answer {
    margin: 10px 0;
    display: grid;
    grid-template-columns: auto auto;
    grid-gap: 10px;
}

.Feedback {
    font-size: 16pt;
    text-align: center;
    min-height: 2em;
}

.Input {
    align: left;
    font-size: 20pt;
}

.Input-text {
    display: block;
    margin: 10px;
    color: inherit;
    width: 140px;
    background-color: #c0c0c0;
    color: #fff;
    padding: 5px;
    padding-left: 10px;
    font-family: inherit;
    font-size: 20px;
    font-weight: inherit;
    line-height: 20pt;
    border: none;
    border-radius: 0.2rem;
    transition: box-shadow 0.1s);
}

.Input-text:focus {
    outline: none;
    background-color: #c0c0c0;
    box-shadow: 0.6rem 0.8rem 1.4rem -0.5rem #999999;
}

.MCButton {
    background: #fafafa;
    border: 1px solid #eee;
    border-radius: 10px;
    padding: 10px;
    font-size: 16px;
    cursor: pointer;
    text-align: center;
}

.MCButton p {
    color: inherit;
}

.MultipleChoiceQn {
    padding: 10px;
    background: var(--medium-slate-blue);
    color: #fafafa;
    border-radius: 10px;
}

.ManyChoiceQn {
    padding: 10px;
    background: var(--orange-pantone);
    color: #fafafa;
    border-radius: 10px;
}

.NumericQn {
    padding: 10px;
    background: var(--russian-violet);
    color: #fafafa;
    border-radius: 10px;
}

.NumericQn p {
    color: inherit;
}

.InpLabel {
    line-height: 34px;
    float: left;
    margin-right: 10px;
    color: #101010;
    font-size: 15pt;
}

.incorrect {
    color: var(--incorrect-red);
}

.correct {
    color: var(--correct-green);
}

.correctButton {
    /*
    background: var(--correct-green);
   */
    animation: correct-anim 0.6s ease;
    animation-fill-mode: forwards;
    color: #fafafa;
    box-shadow: inset 0px 0px 5px #555555;
    outline: none;
}

.incorrectButton {
    animation: incorrect-anim 0.8s ease;
    animation-fill-mode: forwards;
    color: #fafafa;
    box-shadow: inset 0px 0px 5px #555555;
    outline: none;
}

@keyframes incorrect-anim {
    100% {
        background-color: var(--incorrect-red);
    }
}

@keyframes correct-anim {
    100% {
        background-color: var(--correct-green);
    }
}</style></div><script type="application/javascript">var questionsNLCnJvThyOeU=[
    {
        "question": "What is the voltage $V_1$ using the node voltages?",
        "type": "many_choice",
        "answers": [
            {
                "answer": "$V_A$",
                "correct": false,
                "feedback": "Think again."
            },
            {
                "answer": "$-V_A$",
                "correct": true,
                "feedback": "Correct."
            },
            {
                "answer": "$V_B$",
                "correct": false,
                "feedback": "Um, no."
            },
            {
                "answer": "$-V_B$",
                "correct": false,
                "feedback": "Ruh-roh."
            },
            {
                "answer": "$V_C$",
                "correct": false,
                "feedback": "Nope."
            },
            {
                "answer": "$-V_C$",
                "correct": false,
                "feedback": "Incorrect."
            }
        ]
    }
]
;
    // Make a random ID
function makeid(length) {
    var result = [];
    var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
    var charactersLength = characters.length;
    for (var i = 0; i < length; i++) {
        result.push(characters.charAt(Math.floor(Math.random() * charactersLength)));
    }
    return result.join('');
}

// Choose a random subset of an array. Can also be used to shuffle the array
function getRandomSubarray(arr, size) {
    var shuffled = arr.slice(0), i = arr.length, temp, index;
    while (i--) {
        index = Math.floor((i + 1) * Math.random());
        temp = shuffled[index];
        shuffled[index] = shuffled[i];
        shuffled[i] = temp;
    }
    return shuffled.slice(0, size);
}

function printResponses(responsesContainer) {
    var responses=JSON.parse(responsesContainer.dataset.responses);
    var stringResponses='<B>IMPORTANT!</B>To preserve this answer sequence for submission, when you have finalized your answers: <ol> <li> Copy the text in this cell below "Answer String"</li> <li> Double click on the cell directly below the Answer String, labeled "Replace Me"</li> <li> Select the whole "Replace Me" text</li> <li> Paste in your answer string and press shift-Enter.</li><li>Save the notebook using the save icon or File->Save Notebook menu item</li></ul><br><br><br><b>Answer String:</b><br> ';
    console.log(responses);
    responses.forEach((response, index) => {
        if (response) {
            console.log(index + ': ' + response);
            stringResponses+= index + ': ' + response +"<BR>";
        }
    });
    responsesContainer.innerHTML=stringResponses;
}
function check_mc() {
    var id = this.id.split('-')[0];
    //var response = this.id.split('-')[1];
    //console.log(response);
    //console.log("In check_mc(), id="+id);
    //console.log(event.srcElement.id)           
    //console.log(event.srcElement.dataset.correct)   
    //console.log(event.srcElement.dataset.feedback)

    var label = event.srcElement;
    //console.log(label, label.nodeName);
    var depth = 0;
    while ((label.nodeName != "LABEL") && (depth < 20)) {
        label = label.parentElement;
        console.log(depth, label);
        depth++;
    }



    var answers = label.parentElement.children;

    //console.log(answers);


    // Split behavior based on multiple choice vs many choice:
    var fb = document.getElementById("fb" + id);




    if (fb.dataset.numcorrect == 1) {
        // What follows is for the saved responses stuff
        var outerContainer = fb.parentElement.parentElement;
        var responsesContainer = document.getElementById("responses" + outerContainer.id);
        if (responsesContainer) {
            //console.log(responsesContainer);
            var response = label.firstChild.innerText;
            if (label.querySelector(".QuizCode")){
                response+= label.querySelector(".QuizCode").firstChild.innerText;
            }
            console.log(response);
            //console.log(document.getElementById("quizWrap"+id));
            var qnum = document.getElementById("quizWrap"+id).dataset.qnum;
            console.log("Question " + qnum);
            //console.log(id, ", got numcorrect=",fb.dataset.numcorrect);
            var responses=JSON.parse(responsesContainer.dataset.responses);
            console.log(responses);
            responses[qnum]= response;
            responsesContainer.setAttribute('data-responses', JSON.stringify(responses));
            printResponses(responsesContainer);
        }
        // End code to preserve responses
        
        for (var i = 0; i < answers.length; i++) {
            var child = answers[i];
            //console.log(child);
            child.className = "MCButton";
        }



        if (label.dataset.correct == "true") {
            // console.log("Correct action");
            if ("feedback" in label.dataset) {
                fb.textContent = jaxify(label.dataset.feedback);
            } else {
                fb.textContent = "Correct!";
            }
            label.classList.add("correctButton");

            fb.className = "Feedback";
            fb.classList.add("correct");

        } else {
            if ("feedback" in label.dataset) {
                fb.textContent = jaxify(label.dataset.feedback);
            } else {
                fb.textContent = "Incorrect -- try again.";
            }
            //console.log("Error action");
            label.classList.add("incorrectButton");
            fb.className = "Feedback";
            fb.classList.add("incorrect");
        }
    }
    else {
        var reset = false;
        var feedback;
         if (label.dataset.correct == "true") {
            if ("feedback" in label.dataset) {
                feedback = jaxify(label.dataset.feedback);
            } else {
                feedback = "Correct!";
            }
            if (label.dataset.answered <= 0) {
                if (fb.dataset.answeredcorrect < 0) {
                    fb.dataset.answeredcorrect = 1;
                    reset = true;
                } else {
                    fb.dataset.answeredcorrect++;
                }
                if (reset) {
                    for (var i = 0; i < answers.length; i++) {
                        var child = answers[i];
                        child.className = "MCButton";
                        child.dataset.answered = 0;
                    }
                }
                label.classList.add("correctButton");
                label.dataset.answered = 1;
                fb.className = "Feedback";
                fb.classList.add("correct");

            }
        } else {
            if ("feedback" in label.dataset) {
                feedback = jaxify(label.dataset.feedback);
            } else {
                feedback = "Incorrect -- try again.";
            }
            if (fb.dataset.answeredcorrect > 0) {
                fb.dataset.answeredcorrect = -1;
                reset = true;
            } else {
                fb.dataset.answeredcorrect--;
            }

            if (reset) {
                for (var i = 0; i < answers.length; i++) {
                    var child = answers[i];
                    child.className = "MCButton";
                    child.dataset.answered = 0;
                }
            }
            label.classList.add("incorrectButton");
            fb.className = "Feedback";
            fb.classList.add("incorrect");
        }
        // What follows is for the saved responses stuff
        var outerContainer = fb.parentElement.parentElement;
        var responsesContainer = document.getElementById("responses" + outerContainer.id);
        if (responsesContainer) {
            //console.log(responsesContainer);
            var response = label.firstChild.innerText;
            if (label.querySelector(".QuizCode")){
                response+= label.querySelector(".QuizCode").firstChild.innerText;
            }
            console.log(response);
            //console.log(document.getElementById("quizWrap"+id));
            var qnum = document.getElementById("quizWrap"+id).dataset.qnum;
            console.log("Question " + qnum);
            //console.log(id, ", got numcorrect=",fb.dataset.numcorrect);
            var responses=JSON.parse(responsesContainer.dataset.responses);
            if (label.dataset.correct == "true") {
                if (typeof(responses[qnum]) == "object"){
                    if (!responses[qnum].includes(response))
                        responses[qnum].push(response);
                } else{
                    responses[qnum]= [ response ];
                }
            } else {
                responses[qnum]= response;
            }
            console.log(responses);
            responsesContainer.setAttribute('data-responses', JSON.stringify(responses));
            printResponses(responsesContainer);
        }
        // End save responses stuff



        var numcorrect = fb.dataset.numcorrect;
        var answeredcorrect = fb.dataset.answeredcorrect;
        if (answeredcorrect >= 0) {
            fb.textContent = feedback + " [" + answeredcorrect + "/" + numcorrect + "]";
        } else {
            fb.textContent = feedback + " [" + 0 + "/" + numcorrect + "]";
        }


    }

    if (typeof MathJax != 'undefined') {
        var version = MathJax.version;
        console.log('MathJax version', version);
        if (version[0] == "2") {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        } else if (version[0] == "3") {
            MathJax.typeset([fb]);
        }
    } else {
        console.log('MathJax not detected');
    }

}

function make_mc(qa, shuffle_answers, outerqDiv, qDiv, aDiv, id) {
    var shuffled;
    if (shuffle_answers == "True") {
        //console.log(shuffle_answers+" read as true");
        shuffled = getRandomSubarray(qa.answers, qa.answers.length);
    } else {
        //console.log(shuffle_answers+" read as false");
        shuffled = qa.answers;
    }


    var num_correct = 0;



    shuffled.forEach((item, index, ans_array) => {
        //console.log(answer);

        // Make input element
        var inp = document.createElement("input");
        inp.type = "radio";
        inp.id = "quizo" + id + index;
        inp.style = "display:none;";
        aDiv.append(inp);

        //Make label for input element
        var lab = document.createElement("label");
        lab.className = "MCButton";
        lab.id = id + '-' + index;
        lab.onclick = check_mc;
        var aSpan = document.createElement('span');
        aSpan.classsName = "";
        //qDiv.id="quizQn"+id+index;
        if ("answer" in item) {
            aSpan.innerHTML = jaxify(item.answer);
            //aSpan.innerHTML=item.answer;
        }
        lab.append(aSpan);

        // Create div for code inside question
        var codeSpan;
        if ("code" in item) {
            codeSpan = document.createElement('span');
            codeSpan.id = "code" + id + index;
            codeSpan.className = "QuizCode";
            var codePre = document.createElement('pre');
            codeSpan.append(codePre);
            var codeCode = document.createElement('code');
            codePre.append(codeCode);
            codeCode.innerHTML = item.code;
            lab.append(codeSpan);
            //console.log(codeSpan);
        }

        //lab.textContent=item.answer;

        // Set the data attributes for the answer
        lab.setAttribute('data-correct', item.correct);
        if (item.correct) {
            num_correct++;
        }
        if ("feedback" in item) {
            lab.setAttribute('data-feedback', item.feedback);
        }
        lab.setAttribute('data-answered', 0);

        aDiv.append(lab);

    });

    if (num_correct > 1) {
        outerqDiv.className = "ManyChoiceQn";
    } else {
        outerqDiv.className = "MultipleChoiceQn";
    }

    return num_correct;

}
function check_numeric(ths, event) {

    if (event.keyCode === 13) {
        ths.blur();

        var id = ths.id.split('-')[0];

        var submission = ths.value;
        if (submission.indexOf('/') != -1) {
            var sub_parts = submission.split('/');
            //console.log(sub_parts);
            submission = sub_parts[0] / sub_parts[1];
        }
        //console.log("Reader entered", submission);

        if ("precision" in ths.dataset) {
            var precision = ths.dataset.precision;
            // console.log("1:", submission)
            submission = Math.round((1 * submission + Number.EPSILON) * 10 ** precision) / 10 ** precision;
            // console.log("Rounded to ", submission, " precision=", precision  );
        }


        //console.log("In check_numeric(), id="+id);
        //console.log(event.srcElement.id)           
        //console.log(event.srcElement.dataset.feedback)

        var fb = document.getElementById("fb" + id);
        fb.style.display = "none";
        fb.textContent = "Incorrect -- try again.";

        var answers = JSON.parse(ths.dataset.answers);
        //console.log(answers);

        var defaultFB = "";
        var correct;
        var done = false;
        answers.every(answer => {
            //console.log(answer.type);

            correct = false;
            // if (answer.type=="value"){
            if ('value' in answer) {
                if (submission == answer.value) {
                    fb.textContent = jaxify(answer.feedback);
                    correct = answer.correct;
                    //console.log(answer.correct);
                    done = true;
                }
                // } else if (answer.type=="range") {
            } else if ('range' in answer) {
                //console.log(answer.range);
                if ((submission >= answer.range[0]) && (submission < answer.range[1])) {
                    fb.textContent = jaxify(answer.feedback);
                    correct = answer.correct;
                    //console.log(answer.correct);
                    done = true;
                }
            } else if (answer.type == "default") {
                defaultFB = answer.feedback;
            }
            if (done) {
                return false; // Break out of loop if this has been marked correct
            } else {
                return true; // Keep looking for case that includes this as a correct answer
            }
        });

        if ((!done) && (defaultFB != "")) {
            fb.innerHTML = jaxify(defaultFB);
            //console.log("Default feedback", defaultFB);
        }

        fb.style.display = "block";
        if (correct) {
            ths.className = "Input-text";
            ths.classList.add("correctButton");
            fb.className = "Feedback";
            fb.classList.add("correct");
        } else {
            ths.className = "Input-text";
            ths.classList.add("incorrectButton");
            fb.className = "Feedback";
            fb.classList.add("incorrect");
        }

        // What follows is for the saved responses stuff
        var outerContainer = fb.parentElement.parentElement;
        var responsesContainer = document.getElementById("responses" + outerContainer.id);
        if (responsesContainer) {
            console.log(submission);
            var qnum = document.getElementById("quizWrap"+id).dataset.qnum;
            //console.log("Question " + qnum);
            //console.log(id, ", got numcorrect=",fb.dataset.numcorrect);
            var responses=JSON.parse(responsesContainer.dataset.responses);
            console.log(responses);
            if (submission == ths.value){
                responses[qnum]= submission;
            } else {
                responses[qnum]= ths.value + "(" + submission +")";
            }
            responsesContainer.setAttribute('data-responses', JSON.stringify(responses));
            printResponses(responsesContainer);
        }
        // End code to preserve responses

        if (typeof MathJax != 'undefined') {
            var version = MathJax.version;
            console.log('MathJax version', version);
            if (version[0] == "2") {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            } else if (version[0] == "3") {
                MathJax.typeset([fb]);
            }
        } else {
            console.log('MathJax not detected');
        }
        return false;
    }

}

function isValid(el, charC) {
    //console.log("Input char: ", charC);
    if (charC == 46) {
        if (el.value.indexOf('.') === -1) {
            return true;
        } else if (el.value.indexOf('/') != -1) {
            var parts = el.value.split('/');
            if (parts[1].indexOf('.') === -1) {
                return true;
            }
        }
        else {
            return false;
        }
    } else if (charC == 47) {
        if (el.value.indexOf('/') === -1) {
            if ((el.value != "") && (el.value != ".")) {
                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    } else if (charC == 45) {
        var edex = el.value.indexOf('e');
        if (edex == -1) {
            edex = el.value.indexOf('E');
        }

        if (el.value == "") {
            return true;
        } else if (edex == (el.value.length - 1)) { // If just after e or E
            return true;
        } else {
            return false;
        }
    } else if (charC == 101) { // "e"
        if ((el.value.indexOf('e') === -1) && (el.value.indexOf('E') === -1) && (el.value.indexOf('/') == -1)) {
            // Prev symbol must be digit or decimal point:
            if (el.value.slice(-1).search(/\d/) >= 0) {
                return true;
            } else if (el.value.slice(-1).search(/\./) >= 0) {
                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    } else {
        if (charC > 31 && (charC < 48 || charC > 57))
            return false;
    }
    return true;
}

function numeric_keypress(evnt) {
    var charC = (evnt.which) ? evnt.which : evnt.keyCode;

    if (charC == 13) {
        check_numeric(this, evnt);
    } else {
        return isValid(this, charC);
    }
}





function make_numeric(qa, outerqDiv, qDiv, aDiv, id) {



    //console.log(answer);


    outerqDiv.className = "NumericQn";
    aDiv.style.display = 'block';

    var lab = document.createElement("label");
    lab.className = "InpLabel";
    lab.textContent = "Type numeric answer here:";
    aDiv.append(lab);

    var inp = document.createElement("input");
    inp.type = "text";
    //inp.id="input-"+id;
    inp.id = id + "-0";
    inp.className = "Input-text";
    inp.setAttribute('data-answers', JSON.stringify(qa.answers));
    if ("precision" in qa) {
        inp.setAttribute('data-precision', qa.precision);
    }
    aDiv.append(inp);
    //console.log(inp);

    //inp.addEventListener("keypress", check_numeric);
    //inp.addEventListener("keypress", numeric_keypress);
    /*
    inp.addEventListener("keypress", function(event) {
        return numeric_keypress(this, event);
    }
                        );
                        */
    //inp.onkeypress="return numeric_keypress(this, event)";
    inp.onkeypress = numeric_keypress;
    inp.onpaste = event => false;

    inp.addEventListener("focus", function (event) {
        this.value = "";
        return false;
    }
    );


}
function jaxify(string) {
    var mystring = string;

    var count = 0;
    var loc = mystring.search(/([^\\]|^)(\$)/);

    var count2 = 0;
    var loc2 = mystring.search(/([^\\]|^)(\$\$)/);

    //console.log(loc);

    while ((loc >= 0) || (loc2 >= 0)) {

        /* Have to replace all the double $$ first with current implementation */
        if (loc2 >= 0) {
            if (count2 % 2 == 0) {
                mystring = mystring.replace(/([^\\]|^)(\$\$)/, "$1\\[");
            } else {
                mystring = mystring.replace(/([^\\]|^)(\$\$)/, "$1\\]");
            }
            count2++;
        } else {
            if (count % 2 == 0) {
                mystring = mystring.replace(/([^\\]|^)(\$)/, "$1\\(");
            } else {
                mystring = mystring.replace(/([^\\]|^)(\$)/, "$1\\)");
            }
            count++;
        }
        loc = mystring.search(/([^\\]|^)(\$)/);
        loc2 = mystring.search(/([^\\]|^)(\$\$)/);
        //console.log(mystring,", loc:",loc,", loc2:",loc2);
    }

    //console.log(mystring);
    return mystring;
}


function show_questions(json, mydiv) {
    console.log('show_questions');
    //var mydiv=document.getElementById(myid);
    var shuffle_questions = mydiv.dataset.shufflequestions;
    var num_questions = mydiv.dataset.numquestions;
    var shuffle_answers = mydiv.dataset.shuffleanswers;

    if (num_questions > json.length) {
        num_questions = json.length;
    }

    var questions;
    if ((num_questions < json.length) || (shuffle_questions == "True")) {
        //console.log(num_questions+","+json.length);
        questions = getRandomSubarray(json, num_questions);
    } else {
        questions = json;
    }

    //console.log("SQ: "+shuffle_questions+", NQ: " + num_questions + ", SA: ", shuffle_answers);

    // Iterate over questions
    questions.forEach((qa, index, array) => {
        //console.log(qa.question); 

        var id = makeid(8);
        //console.log(id);


        // Create Div to contain question and answers
        var iDiv = document.createElement('div');
        //iDiv.id = 'quizWrap' + id + index;
        iDiv.id = 'quizWrap' + id;
        iDiv.className = 'Quiz';
        iDiv.setAttribute('data-qnum', index);
        mydiv.appendChild(iDiv);
        // iDiv.innerHTML=qa.question;

        var outerqDiv = document.createElement('div');
        outerqDiv.id = "OuterquizQn" + id + index;

        iDiv.append(outerqDiv);

        // Create div to contain question part
        var qDiv = document.createElement('div');
        qDiv.id = "quizQn" + id + index;
        //qDiv.textContent=qa.question;
        qDiv.innerHTML = jaxify(qa.question);

        outerqDiv.append(qDiv);

        // Create div for code inside question
        var codeDiv;
        if ("code" in qa) {
            codeDiv = document.createElement('div');
            codeDiv.id = "code" + id + index;
            codeDiv.className = "QuizCode";
            var codePre = document.createElement('pre');
            codeDiv.append(codePre);
            var codeCode = document.createElement('code');
            codePre.append(codeCode);
            codeCode.innerHTML = qa.code;
            outerqDiv.append(codeDiv);
            //console.log(codeDiv);
        }


        // Create div to contain answer part
        var aDiv = document.createElement('div');
        aDiv.id = "quizAns" + id + index;
        aDiv.className = 'Answer';
        iDiv.append(aDiv);

        //console.log(qa.type);

        var num_correct;
        if (qa.type == "multiple_choice") {
            num_correct = make_mc(qa, shuffle_answers, outerqDiv, qDiv, aDiv, id);
        } else if (qa.type == "many_choice") {
            num_correct = make_mc(qa, shuffle_answers, outerqDiv, qDiv, aDiv, id);
        } else if (qa.type == "numeric") {
            //console.log("numeric");
            make_numeric(qa, outerqDiv, qDiv, aDiv, id);
        }


        //Make div for feedback
        var fb = document.createElement("div");
        fb.id = "fb" + id;
        //fb.style="font-size: 20px;text-align:center;";
        fb.className = "Feedback";
        fb.setAttribute("data-answeredcorrect", 0);
        fb.setAttribute("data-numcorrect", num_correct);
        iDiv.append(fb);


    });
    var preserveResponses = mydiv.dataset.preserveresponses;
    console.log(preserveResponses);
    console.log(preserveResponses == "true");
    if (preserveResponses == "true") {
        console.log(preserveResponses);
        // Create Div to contain record of answers
        var iDiv = document.createElement('div');
        iDiv.id = 'responses' + mydiv.id;
        iDiv.className = 'JCResponses';
        // Create a place to store responses as an empty array
        iDiv.setAttribute('data-responses', '[]');

        // Dummy Text
        iDiv.innerHTML="<b>Select your answers and then follow the directions that will appear here.</b>"
        //iDiv.className = 'Quiz';
        mydiv.appendChild(iDiv);
    }
//console.log("At end of show_questions");
    if (typeof MathJax != 'undefined') {
        console.log("MathJax version", MathJax.version);
        var version = MathJax.version;
        setTimeout(function(){
            var version = MathJax.version;
            console.log('After sleep, MathJax version', version);
            if (version[0] == "2") {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            } else if (version[0] == "3") {
                MathJax.typeset([mydiv]);
            }
        }, 500);
if (typeof version == 'undefined') {
        } else
        {
            if (version[0] == "2") {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            } else if (version[0] == "3") {
                MathJax.typeset([mydiv]);
            } else {
                console.log("MathJax not found");
            }
        }
    }
    return false;
}

        {
        show_questions(questionsNLCnJvThyOeU,  NLCnJvThyOeU);
        }
        </script></div>
</div>
<figure class="align-default" id="nodal-example-2">
<a class="reference internal image-reference" href="_images/nodal-example-2.svg"><img alt="_images/nodal-example-2.svg" height="300px" src="_images/nodal-example-2.svg" /></a>
</figure>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html"><div id="SfsYzYCoBtUR" data-shufflequestions="False"
               data-shuffleanswers="True"
               data-preserveresponses="false"
               data-numquestions="1000000"> <style>:root {
    --medium-slate-blue: #6f78ffff;
    --orange-pantone: #f75c03ff;
    --russian-violet: #392061ff;
    --maximum-yellow-red: #ffc857ff;
    --viridian-green: #119da4ff;
    --incorrect-red: #c80202;
    --correct-green: #009113;
}

.Quiz {
    max-width: 600px;
    margin-top: 15px;
    margin-left: auto;
    margin-right: auto;
    margin-bottom: 15px;
    padding-bottom: 4px;
    padding-top: 4px;
    line-height: 1.1;
    font-size: 16pt;
}

.QuizCode {
    font-size: 14pt;
    margin-top: 10px;
    margin-left: 20px;
    margin-right: 20px;
}

.QuizCode>pre {
    padding: 4px;
}

.Answer {
    margin: 10px 0;
    display: grid;
    grid-template-columns: auto auto;
    grid-gap: 10px;
}

.Feedback {
    font-size: 16pt;
    text-align: center;
    min-height: 2em;
}

.Input {
    align: left;
    font-size: 20pt;
}

.Input-text {
    display: block;
    margin: 10px;
    color: inherit;
    width: 140px;
    background-color: #c0c0c0;
    color: #fff;
    padding: 5px;
    padding-left: 10px;
    font-family: inherit;
    font-size: 20px;
    font-weight: inherit;
    line-height: 20pt;
    border: none;
    border-radius: 0.2rem;
    transition: box-shadow 0.1s);
}

.Input-text:focus {
    outline: none;
    background-color: #c0c0c0;
    box-shadow: 0.6rem 0.8rem 1.4rem -0.5rem #999999;
}

.MCButton {
    background: #fafafa;
    border: 1px solid #eee;
    border-radius: 10px;
    padding: 10px;
    font-size: 16px;
    cursor: pointer;
    text-align: center;
}

.MCButton p {
    color: inherit;
}

.MultipleChoiceQn {
    padding: 10px;
    background: var(--medium-slate-blue);
    color: #fafafa;
    border-radius: 10px;
}

.ManyChoiceQn {
    padding: 10px;
    background: var(--orange-pantone);
    color: #fafafa;
    border-radius: 10px;
}

.NumericQn {
    padding: 10px;
    background: var(--russian-violet);
    color: #fafafa;
    border-radius: 10px;
}

.NumericQn p {
    color: inherit;
}

.InpLabel {
    line-height: 34px;
    float: left;
    margin-right: 10px;
    color: #101010;
    font-size: 15pt;
}

.incorrect {
    color: var(--incorrect-red);
}

.correct {
    color: var(--correct-green);
}

.correctButton {
    /*
    background: var(--correct-green);
   */
    animation: correct-anim 0.6s ease;
    animation-fill-mode: forwards;
    color: #fafafa;
    box-shadow: inset 0px 0px 5px #555555;
    outline: none;
}

.incorrectButton {
    animation: incorrect-anim 0.8s ease;
    animation-fill-mode: forwards;
    color: #fafafa;
    box-shadow: inset 0px 0px 5px #555555;
    outline: none;
}

@keyframes incorrect-anim {
    100% {
        background-color: var(--incorrect-red);
    }
}

@keyframes correct-anim {
    100% {
        background-color: var(--correct-green);
    }
}</style></div><script type="application/javascript">var questionsSfsYzYCoBtUR=[
    {
        "question": "What is the current $I_a$ using the node voltages and resistance values?",
        "type": "many_choice",
        "answers": [
            {
                "answer": "$V_A/R_1$",
                "correct": false,
                "feedback": "Think again."
            },
            {
                "answer": "$-V_A/R_1$",
                "correct": true,
                "feedback": "Correct."
            },
            {
                "answer": "$V_B/R_1$",
                "correct": false,
                "feedback": "Um, no."
            },
            {
                "answer": "$-V_B/R_1$",
                "correct": false,
                "feedback": "Ruh-roh."
            },
            {
                "answer": "$V_A/R_2$",
                "correct": false,
                "feedback": "Nope."
            },
            {
                "answer": "$-V_A/R_2$",
                "correct": false,
                "feedback": "Incorrect."
            }
        ]
    }
]
;
    // Make a random ID
function makeid(length) {
    var result = [];
    var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
    var charactersLength = characters.length;
    for (var i = 0; i < length; i++) {
        result.push(characters.charAt(Math.floor(Math.random() * charactersLength)));
    }
    return result.join('');
}

// Choose a random subset of an array. Can also be used to shuffle the array
function getRandomSubarray(arr, size) {
    var shuffled = arr.slice(0), i = arr.length, temp, index;
    while (i--) {
        index = Math.floor((i + 1) * Math.random());
        temp = shuffled[index];
        shuffled[index] = shuffled[i];
        shuffled[i] = temp;
    }
    return shuffled.slice(0, size);
}

function printResponses(responsesContainer) {
    var responses=JSON.parse(responsesContainer.dataset.responses);
    var stringResponses='<B>IMPORTANT!</B>To preserve this answer sequence for submission, when you have finalized your answers: <ol> <li> Copy the text in this cell below "Answer String"</li> <li> Double click on the cell directly below the Answer String, labeled "Replace Me"</li> <li> Select the whole "Replace Me" text</li> <li> Paste in your answer string and press shift-Enter.</li><li>Save the notebook using the save icon or File->Save Notebook menu item</li></ul><br><br><br><b>Answer String:</b><br> ';
    console.log(responses);
    responses.forEach((response, index) => {
        if (response) {
            console.log(index + ': ' + response);
            stringResponses+= index + ': ' + response +"<BR>";
        }
    });
    responsesContainer.innerHTML=stringResponses;
}
function check_mc() {
    var id = this.id.split('-')[0];
    //var response = this.id.split('-')[1];
    //console.log(response);
    //console.log("In check_mc(), id="+id);
    //console.log(event.srcElement.id)           
    //console.log(event.srcElement.dataset.correct)   
    //console.log(event.srcElement.dataset.feedback)

    var label = event.srcElement;
    //console.log(label, label.nodeName);
    var depth = 0;
    while ((label.nodeName != "LABEL") && (depth < 20)) {
        label = label.parentElement;
        console.log(depth, label);
        depth++;
    }



    var answers = label.parentElement.children;

    //console.log(answers);


    // Split behavior based on multiple choice vs many choice:
    var fb = document.getElementById("fb" + id);




    if (fb.dataset.numcorrect == 1) {
        // What follows is for the saved responses stuff
        var outerContainer = fb.parentElement.parentElement;
        var responsesContainer = document.getElementById("responses" + outerContainer.id);
        if (responsesContainer) {
            //console.log(responsesContainer);
            var response = label.firstChild.innerText;
            if (label.querySelector(".QuizCode")){
                response+= label.querySelector(".QuizCode").firstChild.innerText;
            }
            console.log(response);
            //console.log(document.getElementById("quizWrap"+id));
            var qnum = document.getElementById("quizWrap"+id).dataset.qnum;
            console.log("Question " + qnum);
            //console.log(id, ", got numcorrect=",fb.dataset.numcorrect);
            var responses=JSON.parse(responsesContainer.dataset.responses);
            console.log(responses);
            responses[qnum]= response;
            responsesContainer.setAttribute('data-responses', JSON.stringify(responses));
            printResponses(responsesContainer);
        }
        // End code to preserve responses
        
        for (var i = 0; i < answers.length; i++) {
            var child = answers[i];
            //console.log(child);
            child.className = "MCButton";
        }



        if (label.dataset.correct == "true") {
            // console.log("Correct action");
            if ("feedback" in label.dataset) {
                fb.textContent = jaxify(label.dataset.feedback);
            } else {
                fb.textContent = "Correct!";
            }
            label.classList.add("correctButton");

            fb.className = "Feedback";
            fb.classList.add("correct");

        } else {
            if ("feedback" in label.dataset) {
                fb.textContent = jaxify(label.dataset.feedback);
            } else {
                fb.textContent = "Incorrect -- try again.";
            }
            //console.log("Error action");
            label.classList.add("incorrectButton");
            fb.className = "Feedback";
            fb.classList.add("incorrect");
        }
    }
    else {
        var reset = false;
        var feedback;
         if (label.dataset.correct == "true") {
            if ("feedback" in label.dataset) {
                feedback = jaxify(label.dataset.feedback);
            } else {
                feedback = "Correct!";
            }
            if (label.dataset.answered <= 0) {
                if (fb.dataset.answeredcorrect < 0) {
                    fb.dataset.answeredcorrect = 1;
                    reset = true;
                } else {
                    fb.dataset.answeredcorrect++;
                }
                if (reset) {
                    for (var i = 0; i < answers.length; i++) {
                        var child = answers[i];
                        child.className = "MCButton";
                        child.dataset.answered = 0;
                    }
                }
                label.classList.add("correctButton");
                label.dataset.answered = 1;
                fb.className = "Feedback";
                fb.classList.add("correct");

            }
        } else {
            if ("feedback" in label.dataset) {
                feedback = jaxify(label.dataset.feedback);
            } else {
                feedback = "Incorrect -- try again.";
            }
            if (fb.dataset.answeredcorrect > 0) {
                fb.dataset.answeredcorrect = -1;
                reset = true;
            } else {
                fb.dataset.answeredcorrect--;
            }

            if (reset) {
                for (var i = 0; i < answers.length; i++) {
                    var child = answers[i];
                    child.className = "MCButton";
                    child.dataset.answered = 0;
                }
            }
            label.classList.add("incorrectButton");
            fb.className = "Feedback";
            fb.classList.add("incorrect");
        }
        // What follows is for the saved responses stuff
        var outerContainer = fb.parentElement.parentElement;
        var responsesContainer = document.getElementById("responses" + outerContainer.id);
        if (responsesContainer) {
            //console.log(responsesContainer);
            var response = label.firstChild.innerText;
            if (label.querySelector(".QuizCode")){
                response+= label.querySelector(".QuizCode").firstChild.innerText;
            }
            console.log(response);
            //console.log(document.getElementById("quizWrap"+id));
            var qnum = document.getElementById("quizWrap"+id).dataset.qnum;
            console.log("Question " + qnum);
            //console.log(id, ", got numcorrect=",fb.dataset.numcorrect);
            var responses=JSON.parse(responsesContainer.dataset.responses);
            if (label.dataset.correct == "true") {
                if (typeof(responses[qnum]) == "object"){
                    if (!responses[qnum].includes(response))
                        responses[qnum].push(response);
                } else{
                    responses[qnum]= [ response ];
                }
            } else {
                responses[qnum]= response;
            }
            console.log(responses);
            responsesContainer.setAttribute('data-responses', JSON.stringify(responses));
            printResponses(responsesContainer);
        }
        // End save responses stuff



        var numcorrect = fb.dataset.numcorrect;
        var answeredcorrect = fb.dataset.answeredcorrect;
        if (answeredcorrect >= 0) {
            fb.textContent = feedback + " [" + answeredcorrect + "/" + numcorrect + "]";
        } else {
            fb.textContent = feedback + " [" + 0 + "/" + numcorrect + "]";
        }


    }

    if (typeof MathJax != 'undefined') {
        var version = MathJax.version;
        console.log('MathJax version', version);
        if (version[0] == "2") {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        } else if (version[0] == "3") {
            MathJax.typeset([fb]);
        }
    } else {
        console.log('MathJax not detected');
    }

}

function make_mc(qa, shuffle_answers, outerqDiv, qDiv, aDiv, id) {
    var shuffled;
    if (shuffle_answers == "True") {
        //console.log(shuffle_answers+" read as true");
        shuffled = getRandomSubarray(qa.answers, qa.answers.length);
    } else {
        //console.log(shuffle_answers+" read as false");
        shuffled = qa.answers;
    }


    var num_correct = 0;



    shuffled.forEach((item, index, ans_array) => {
        //console.log(answer);

        // Make input element
        var inp = document.createElement("input");
        inp.type = "radio";
        inp.id = "quizo" + id + index;
        inp.style = "display:none;";
        aDiv.append(inp);

        //Make label for input element
        var lab = document.createElement("label");
        lab.className = "MCButton";
        lab.id = id + '-' + index;
        lab.onclick = check_mc;
        var aSpan = document.createElement('span');
        aSpan.classsName = "";
        //qDiv.id="quizQn"+id+index;
        if ("answer" in item) {
            aSpan.innerHTML = jaxify(item.answer);
            //aSpan.innerHTML=item.answer;
        }
        lab.append(aSpan);

        // Create div for code inside question
        var codeSpan;
        if ("code" in item) {
            codeSpan = document.createElement('span');
            codeSpan.id = "code" + id + index;
            codeSpan.className = "QuizCode";
            var codePre = document.createElement('pre');
            codeSpan.append(codePre);
            var codeCode = document.createElement('code');
            codePre.append(codeCode);
            codeCode.innerHTML = item.code;
            lab.append(codeSpan);
            //console.log(codeSpan);
        }

        //lab.textContent=item.answer;

        // Set the data attributes for the answer
        lab.setAttribute('data-correct', item.correct);
        if (item.correct) {
            num_correct++;
        }
        if ("feedback" in item) {
            lab.setAttribute('data-feedback', item.feedback);
        }
        lab.setAttribute('data-answered', 0);

        aDiv.append(lab);

    });

    if (num_correct > 1) {
        outerqDiv.className = "ManyChoiceQn";
    } else {
        outerqDiv.className = "MultipleChoiceQn";
    }

    return num_correct;

}
function check_numeric(ths, event) {

    if (event.keyCode === 13) {
        ths.blur();

        var id = ths.id.split('-')[0];

        var submission = ths.value;
        if (submission.indexOf('/') != -1) {
            var sub_parts = submission.split('/');
            //console.log(sub_parts);
            submission = sub_parts[0] / sub_parts[1];
        }
        //console.log("Reader entered", submission);

        if ("precision" in ths.dataset) {
            var precision = ths.dataset.precision;
            // console.log("1:", submission)
            submission = Math.round((1 * submission + Number.EPSILON) * 10 ** precision) / 10 ** precision;
            // console.log("Rounded to ", submission, " precision=", precision  );
        }


        //console.log("In check_numeric(), id="+id);
        //console.log(event.srcElement.id)           
        //console.log(event.srcElement.dataset.feedback)

        var fb = document.getElementById("fb" + id);
        fb.style.display = "none";
        fb.textContent = "Incorrect -- try again.";

        var answers = JSON.parse(ths.dataset.answers);
        //console.log(answers);

        var defaultFB = "";
        var correct;
        var done = false;
        answers.every(answer => {
            //console.log(answer.type);

            correct = false;
            // if (answer.type=="value"){
            if ('value' in answer) {
                if (submission == answer.value) {
                    fb.textContent = jaxify(answer.feedback);
                    correct = answer.correct;
                    //console.log(answer.correct);
                    done = true;
                }
                // } else if (answer.type=="range") {
            } else if ('range' in answer) {
                //console.log(answer.range);
                if ((submission >= answer.range[0]) && (submission < answer.range[1])) {
                    fb.textContent = jaxify(answer.feedback);
                    correct = answer.correct;
                    //console.log(answer.correct);
                    done = true;
                }
            } else if (answer.type == "default") {
                defaultFB = answer.feedback;
            }
            if (done) {
                return false; // Break out of loop if this has been marked correct
            } else {
                return true; // Keep looking for case that includes this as a correct answer
            }
        });

        if ((!done) && (defaultFB != "")) {
            fb.innerHTML = jaxify(defaultFB);
            //console.log("Default feedback", defaultFB);
        }

        fb.style.display = "block";
        if (correct) {
            ths.className = "Input-text";
            ths.classList.add("correctButton");
            fb.className = "Feedback";
            fb.classList.add("correct");
        } else {
            ths.className = "Input-text";
            ths.classList.add("incorrectButton");
            fb.className = "Feedback";
            fb.classList.add("incorrect");
        }

        // What follows is for the saved responses stuff
        var outerContainer = fb.parentElement.parentElement;
        var responsesContainer = document.getElementById("responses" + outerContainer.id);
        if (responsesContainer) {
            console.log(submission);
            var qnum = document.getElementById("quizWrap"+id).dataset.qnum;
            //console.log("Question " + qnum);
            //console.log(id, ", got numcorrect=",fb.dataset.numcorrect);
            var responses=JSON.parse(responsesContainer.dataset.responses);
            console.log(responses);
            if (submission == ths.value){
                responses[qnum]= submission;
            } else {
                responses[qnum]= ths.value + "(" + submission +")";
            }
            responsesContainer.setAttribute('data-responses', JSON.stringify(responses));
            printResponses(responsesContainer);
        }
        // End code to preserve responses

        if (typeof MathJax != 'undefined') {
            var version = MathJax.version;
            console.log('MathJax version', version);
            if (version[0] == "2") {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            } else if (version[0] == "3") {
                MathJax.typeset([fb]);
            }
        } else {
            console.log('MathJax not detected');
        }
        return false;
    }

}

function isValid(el, charC) {
    //console.log("Input char: ", charC);
    if (charC == 46) {
        if (el.value.indexOf('.') === -1) {
            return true;
        } else if (el.value.indexOf('/') != -1) {
            var parts = el.value.split('/');
            if (parts[1].indexOf('.') === -1) {
                return true;
            }
        }
        else {
            return false;
        }
    } else if (charC == 47) {
        if (el.value.indexOf('/') === -1) {
            if ((el.value != "") && (el.value != ".")) {
                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    } else if (charC == 45) {
        var edex = el.value.indexOf('e');
        if (edex == -1) {
            edex = el.value.indexOf('E');
        }

        if (el.value == "") {
            return true;
        } else if (edex == (el.value.length - 1)) { // If just after e or E
            return true;
        } else {
            return false;
        }
    } else if (charC == 101) { // "e"
        if ((el.value.indexOf('e') === -1) && (el.value.indexOf('E') === -1) && (el.value.indexOf('/') == -1)) {
            // Prev symbol must be digit or decimal point:
            if (el.value.slice(-1).search(/\d/) >= 0) {
                return true;
            } else if (el.value.slice(-1).search(/\./) >= 0) {
                return true;
            } else {
                return false;
            }
        } else {
            return false;
        }
    } else {
        if (charC > 31 && (charC < 48 || charC > 57))
            return false;
    }
    return true;
}

function numeric_keypress(evnt) {
    var charC = (evnt.which) ? evnt.which : evnt.keyCode;

    if (charC == 13) {
        check_numeric(this, evnt);
    } else {
        return isValid(this, charC);
    }
}





function make_numeric(qa, outerqDiv, qDiv, aDiv, id) {



    //console.log(answer);


    outerqDiv.className = "NumericQn";
    aDiv.style.display = 'block';

    var lab = document.createElement("label");
    lab.className = "InpLabel";
    lab.textContent = "Type numeric answer here:";
    aDiv.append(lab);

    var inp = document.createElement("input");
    inp.type = "text";
    //inp.id="input-"+id;
    inp.id = id + "-0";
    inp.className = "Input-text";
    inp.setAttribute('data-answers', JSON.stringify(qa.answers));
    if ("precision" in qa) {
        inp.setAttribute('data-precision', qa.precision);
    }
    aDiv.append(inp);
    //console.log(inp);

    //inp.addEventListener("keypress", check_numeric);
    //inp.addEventListener("keypress", numeric_keypress);
    /*
    inp.addEventListener("keypress", function(event) {
        return numeric_keypress(this, event);
    }
                        );
                        */
    //inp.onkeypress="return numeric_keypress(this, event)";
    inp.onkeypress = numeric_keypress;
    inp.onpaste = event => false;

    inp.addEventListener("focus", function (event) {
        this.value = "";
        return false;
    }
    );


}
function jaxify(string) {
    var mystring = string;

    var count = 0;
    var loc = mystring.search(/([^\\]|^)(\$)/);

    var count2 = 0;
    var loc2 = mystring.search(/([^\\]|^)(\$\$)/);

    //console.log(loc);

    while ((loc >= 0) || (loc2 >= 0)) {

        /* Have to replace all the double $$ first with current implementation */
        if (loc2 >= 0) {
            if (count2 % 2 == 0) {
                mystring = mystring.replace(/([^\\]|^)(\$\$)/, "$1\\[");
            } else {
                mystring = mystring.replace(/([^\\]|^)(\$\$)/, "$1\\]");
            }
            count2++;
        } else {
            if (count % 2 == 0) {
                mystring = mystring.replace(/([^\\]|^)(\$)/, "$1\\(");
            } else {
                mystring = mystring.replace(/([^\\]|^)(\$)/, "$1\\)");
            }
            count++;
        }
        loc = mystring.search(/([^\\]|^)(\$)/);
        loc2 = mystring.search(/([^\\]|^)(\$\$)/);
        //console.log(mystring,", loc:",loc,", loc2:",loc2);
    }

    //console.log(mystring);
    return mystring;
}


function show_questions(json, mydiv) {
    console.log('show_questions');
    //var mydiv=document.getElementById(myid);
    var shuffle_questions = mydiv.dataset.shufflequestions;
    var num_questions = mydiv.dataset.numquestions;
    var shuffle_answers = mydiv.dataset.shuffleanswers;

    if (num_questions > json.length) {
        num_questions = json.length;
    }

    var questions;
    if ((num_questions < json.length) || (shuffle_questions == "True")) {
        //console.log(num_questions+","+json.length);
        questions = getRandomSubarray(json, num_questions);
    } else {
        questions = json;
    }

    //console.log("SQ: "+shuffle_questions+", NQ: " + num_questions + ", SA: ", shuffle_answers);

    // Iterate over questions
    questions.forEach((qa, index, array) => {
        //console.log(qa.question); 

        var id = makeid(8);
        //console.log(id);


        // Create Div to contain question and answers
        var iDiv = document.createElement('div');
        //iDiv.id = 'quizWrap' + id + index;
        iDiv.id = 'quizWrap' + id;
        iDiv.className = 'Quiz';
        iDiv.setAttribute('data-qnum', index);
        mydiv.appendChild(iDiv);
        // iDiv.innerHTML=qa.question;

        var outerqDiv = document.createElement('div');
        outerqDiv.id = "OuterquizQn" + id + index;

        iDiv.append(outerqDiv);

        // Create div to contain question part
        var qDiv = document.createElement('div');
        qDiv.id = "quizQn" + id + index;
        //qDiv.textContent=qa.question;
        qDiv.innerHTML = jaxify(qa.question);

        outerqDiv.append(qDiv);

        // Create div for code inside question
        var codeDiv;
        if ("code" in qa) {
            codeDiv = document.createElement('div');
            codeDiv.id = "code" + id + index;
            codeDiv.className = "QuizCode";
            var codePre = document.createElement('pre');
            codeDiv.append(codePre);
            var codeCode = document.createElement('code');
            codePre.append(codeCode);
            codeCode.innerHTML = qa.code;
            outerqDiv.append(codeDiv);
            //console.log(codeDiv);
        }


        // Create div to contain answer part
        var aDiv = document.createElement('div');
        aDiv.id = "quizAns" + id + index;
        aDiv.className = 'Answer';
        iDiv.append(aDiv);

        //console.log(qa.type);

        var num_correct;
        if (qa.type == "multiple_choice") {
            num_correct = make_mc(qa, shuffle_answers, outerqDiv, qDiv, aDiv, id);
        } else if (qa.type == "many_choice") {
            num_correct = make_mc(qa, shuffle_answers, outerqDiv, qDiv, aDiv, id);
        } else if (qa.type == "numeric") {
            //console.log("numeric");
            make_numeric(qa, outerqDiv, qDiv, aDiv, id);
        }


        //Make div for feedback
        var fb = document.createElement("div");
        fb.id = "fb" + id;
        //fb.style="font-size: 20px;text-align:center;";
        fb.className = "Feedback";
        fb.setAttribute("data-answeredcorrect", 0);
        fb.setAttribute("data-numcorrect", num_correct);
        iDiv.append(fb);


    });
    var preserveResponses = mydiv.dataset.preserveresponses;
    console.log(preserveResponses);
    console.log(preserveResponses == "true");
    if (preserveResponses == "true") {
        console.log(preserveResponses);
        // Create Div to contain record of answers
        var iDiv = document.createElement('div');
        iDiv.id = 'responses' + mydiv.id;
        iDiv.className = 'JCResponses';
        // Create a place to store responses as an empty array
        iDiv.setAttribute('data-responses', '[]');

        // Dummy Text
        iDiv.innerHTML="<b>Select your answers and then follow the directions that will appear here.</b>"
        //iDiv.className = 'Quiz';
        mydiv.appendChild(iDiv);
    }
//console.log("At end of show_questions");
    if (typeof MathJax != 'undefined') {
        console.log("MathJax version", MathJax.version);
        var version = MathJax.version;
        setTimeout(function(){
            var version = MathJax.version;
            console.log('After sleep, MathJax version', version);
            if (version[0] == "2") {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            } else if (version[0] == "3") {
                MathJax.typeset([mydiv]);
            }
        }, 500);
if (typeof version == 'undefined') {
        } else
        {
            if (version[0] == "2") {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            } else if (version[0] == "3") {
                MathJax.typeset([mydiv]);
            } else {
                console.log("MathJax not found");
            }
        }
    }
    return false;
}

        {
        show_questions(questionsSfsYzYCoBtUR,  SfsYzYCoBtUR);
        }
        </script></div>
</div>
<figure class="align-default" id="label-for-this-image3">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><span class="math notranslate nohighlight">\(I_a = \underline{\ \ \ \ \ \ \ \ \ \ \ \ }\)</span></p>
<p><span class="math notranslate nohighlight">\(I_b = \underline{\ \ \ \ \ \ \ \ \ \ \ \ }\)</span></p>
<p><span class="math notranslate nohighlight">\(I_c = \underline{\ \ \ \ \ \ \ \ \ \ \ \ }\)</span></p>
<p><span class="math notranslate nohighlight">\(I_d = \underline{\ \ \ \ \ \ \ \ \ \ \ \ }\)</span></p>
<p><span class="math notranslate nohighlight">\(I_e = \underline{\ \ \ \ \ \ \ \ \ \ \ \ }\)</span></p>
<p><span class="math notranslate nohighlight">\(I_f = \underline{\ \ \ \ \ \ \ \ \ \ \ \ }\)</span></p>
</section>
<section id="the-steps">
<h2>The Steps<a class="headerlink" href="#the-steps" title="Permalink to this headline">#</a></h2>
<p>I’m going to list the steps here as reference. Use these steps as we walk through the next example.</p>
<div class="admonition-steps-for-nodal-analysis admonition">
<p class="admonition-title">Steps for Nodal Analysis</p>
<ol class="simple">
<li><p>Label the non-reference nodes and a current direction for each passive circuit element.</p></li>
<li><p>Use KCL on each non-reference node.</p></li>
<li><p>Use Ohm’s law to express the resistor currents in terms of node voltages.</p></li>
<li><p>Distribute and group like terms.</p></li>
<li><p>Plug in values and solve the system.</p></li>
</ol>
</div>
<p>These steps give us a starting point for the first example. We’ll develop what to do with special circumstances in more complex circuits.</p>
</section>
<section id="our-first-toy-problem">
<h2>Our First Toy Problem<a class="headerlink" href="#our-first-toy-problem" title="Permalink to this headline">#</a></h2>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(I_O\)</span> using Nodal Analysis.</p>
<figure class="align-default" id="label-for-this-image4">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>Start by labeling the non-reference nodes as shown below. Pick a current direction for each passive component. For this problem that means the resistors. In future problems we’ll also label current directions for the other passive elements, the capacitors and inductors. These current arrows will help us keep the signs consistent in the system of equations we’re about to develop to find the unknowns.</p>
<figure class="align-default" id="label-for-this-image5">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>KCL for Node A</strong></p>
<p>Each term in a KCL must be a current. In the case of node A there will be two terms since two circuit elements are connected to it. The first term I’ll write is the current through <span class="math notranslate nohighlight">\(I_S\)</span>. This term is a constant current and the simplest term we will encounter in Nodal Analysis.</p>
<p>The second term takes the form that we practice in the earlier section of this chapter. This term will be the current through <span class="math notranslate nohighlight">\(R_1\)</span>. And of course, we set it equal to zero and Kirchhoff instructed.</p>
<div class="math notranslate nohighlight">
\[
 I_S-I_{R1}=0
\]</div>
<p>Notice the sign of each term. The <span class="math notranslate nohighlight">\(I_S\)</span> term is positive since the current is entering node A. This arrow was not our choice. It is simply taken from the direction of the arrow with in the current supply symbol.</p>
<p>The second term is negative. The arrow we drew for <span class="math notranslate nohighlight">\(I_{R1}\)</span> is leaving node A leading to the negative sign. This is the term that we will need to rewrite to be in terms of the unknown node voltages. Stop and look at the schematic to figure out which node is at the tail of the arrow. Now find the node connected to the tip of the arrow. I’m hope you identified Node A at the tail and Node B at the tip. Using the voltages at the nodes with respect to ground we can write an expression for the current through <span class="math notranslate nohighlight">\(R_1\)</span></p>
<div class="math notranslate nohighlight">
\[
I_{R1}=\frac{V_A-V_B}{R_1}
\]</div>
<p>We then substitute this expression into the KCL we wrote above.</p>
<div class="math notranslate nohighlight">
\[
 I_S-\frac{V_A-V_B}{R_1}=0
\]</div>
<p>Notice that the sign front of the second term remains negative. In order to group like terms we will break up the fraction</p>
<div class="math notranslate nohighlight">
\[
 I_S-\left[\frac{V_A}{R_1}-\frac{V_B}{R_1}\right]=0
\]</div>
<p>and distribute the sign from the KCL</p>
<div class="math notranslate nohighlight">
\[
 I_S-\frac{1}{R_1}V_A+\frac{1}{R_1}V_B=0
\]</div>
<p>Moving the constant to the right hand side gives us</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{R_1}V_A+\frac{1}{R_1}V_B=-I_S
\]</div>
<p>and plugging in values gives us</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{2}V_A+\frac{1}{2}V_B=-6
\]</div>
<p>in a form we can use in the system of equations. We have constants and the unknown node voltages, nothing else. Any other variables will have to be dealt with. This example doesn’t have any other variables but will will encounter them in future examples.</p>
<p><strong>KCL for Node B</strong></p>
<p>We follow the same process for node B. Node B has three elements connected to it. Therefore the KCL for this node will have three terms.</p>
<div class="math notranslate nohighlight">
\[
I_{R1}-I_{R2}-I_{R3}=0
\]</div>
<p><span class="math notranslate nohighlight">\(I_{R1}\)</span> is the only current out of the three that is entering the node and therefore is the only positive term in this KCL. The other two currents are leaving node B and the corresponding terms are both negative.</p>
<p>All three currents follow the usual format, voltage at the tail minus voltage at the tip over the resistance. <span class="math notranslate nohighlight">\(I_{R1}\)</span> and <span class="math notranslate nohighlight">\(I_{R3}\)</span> will look similar to the term we substituted in the previous KCL equation.</p>
<div class="math notranslate nohighlight">
\[
I_{R1}=\frac{V_A-V_B}{R_1}
\]</div>
<div class="math notranslate nohighlight">
\[
I_{R3}=\frac{V_B-V_C}{R_3}
\]</div>
<p>In fact, the expression for <span class="math notranslate nohighlight">\(I_{R1}\)</span> is identical to then one we wrote previously. The expression for <span class="math notranslate nohighlight">\(I_{R2}\)</span> will end up looking a little different. Stop and find the voltages at the tail and tip of the arrow for <span class="math notranslate nohighlight">\(I_{R2}\)</span>. The voltage at the tail is <span class="math notranslate nohighlight">\(V_B\)</span>. The voltage at the tip is 0~\text{V}. The tip of this arrow points to the ground node and the difference between this node and itself is 0~\text{V}. We can include this 0~\text{V} in the expression</p>
<div class="math notranslate nohighlight">
\[
I_{R2}=\frac{V_B-0}{R_2}
\]</div>
<p>but more often than not we exclude it as it is simply a subtraction by zero</p>
<div class="math notranslate nohighlight">
\[
I_{R2}=\frac{V_B}{R_2}
\]</div>
<p>Substituting these expressions into the KCL gives us</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_B}{R_1}-\frac{V_B}{R_2}-\frac{V_B-V_C}{R_3}=0
\]</div>
<p>Breaking up the fractions and distributing the signs leads to</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_1}V_A-\frac{1}{R_1}V_B-\frac{1}{R_2}V_B-\frac{1}{R_3}V_B+\frac{1}{R_3}V_C=0
\]</div>
<p>before grouping like terms</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_1}V_A+\left[-\frac{1}{R_1}-\frac{1}{R_2}-\frac{1}{R_3}\right]V_B+\frac{1}{R_3}V_C=0
\]</div>
<p>and plugging in values</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{2}V_A-V_B+\frac{1}{4}V_C=0
\]</div>
<p>We’re finally done with this one. We’re left with an equation with constants and the unknown node voltages, nothing more.</p>
<p><strong>KCL for Node C</strong></p>
<p>The last KCL we will write is for node C. Two elements are connected to node C, both resistors in this circuit. <span class="math notranslate nohighlight">\(I_{R3}\)</span> is entering node C and therefore the term will be positive. <span class="math notranslate nohighlight">\(I_{R4}\)</span> is leaving node C and therefore the term will be negative.</p>
<div class="math notranslate nohighlight">
\[
I_{R3}-I_{R4}=0
\]</div>
<p>The expression for <span class="math notranslate nohighlight">\(I_{R3}\)</span> matches what we wrote previously. <span class="math notranslate nohighlight">\(I_{R4}\)</span> again has the tip of the arrow pointing at ground giving us the expression</p>
<div class="math notranslate nohighlight">
\[
I_{R4}=\frac{V_C-0}{R_4}=\frac{V_C}{R_4}
\]</div>
<p>Substituting the two expressions into the KCL gives us</p>
<div class="math notranslate nohighlight">
\[
\frac{V_B-V_C}{R_3}-\frac{V_C}{R_4}=0
\]</div>
<p>Breaking up the fractions and distributing the signs leads to</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_3}V_B-\frac{1}{R_3}V_C-\frac{1}{R_4}V_C=0
\]</div>
<p>before grouping like terms</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_3}V_B+\left[-\frac{1}{R_3}-\frac{1}{R_4}\right]V_C=0
\]</div>
<p>and plugging in values</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{4}V_B-\frac{3}{4}V_C=0
\]</div>
<p>And we’re done with this one. Again, we’re left with an equation with constants and the unknown node voltages, nothing more.</p>
<p><strong>Solving the system of equations</strong></p>
<p>We have three equations and three unknowns. Let’s collect the equations from above here for easy reference.</p>
<div class="amsmath math notranslate nohighlight" id="equation-0e57e847-3de7-4434-8be5-865a460c03f2">
<span class="eqno">(5)<a class="headerlink" href="#equation-0e57e847-3de7-4434-8be5-865a460c03f2" title="Permalink to this equation">#</a></span>\[\begin{eqnarray}
-\frac{1}{2}V_A+\frac{1}{2}V_B&amp;=&amp;-6\\
\frac{1}{2}V_A-V_B+\frac{1}{4}V_C&amp;=&amp;0\\
\frac{1}{4}V_B-\frac{3}{4}V_C&amp;=&amp;0
\end{eqnarray}\]</div>
<p>Be very careful transferring the coefficients to matrices as some terms have coefficients of zero and do not appear in the equations above.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrr}
-\frac{1}{2}&amp;\frac{1}{2}&amp;0\\
\frac{1}{2}&amp;-1&amp;\frac{1}{4}\\
0&amp;\frac{1}{4}&amp;-\frac{3}{4}
\end{array} \right]^{-1}\left[\begin{array}{r}-6\\0\\0\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\end{array}\right]=\left[\begin{array}{r}26.4~\text{V}\\14.4~\text{V}\\4.8~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Using the Node Voltages to Find Other Values</strong></p>
<p>Once you know the node voltage you can find any other value in the circuit. Let’s find <span class="math notranslate nohighlight">\(I_O\)</span> for this example. <span class="math notranslate nohighlight">\(I_O\)</span> is the current flowing down through <span class="math notranslate nohighlight">\(R_2\)</span>. The voltage across <span class="math notranslate nohighlight">\(R_2\)</span> is the voltage at the tail of the current arrow, <span class="math notranslate nohighlight">\(V_B\)</span> for this circuit, minus the voltage at the tip of the current arrow, ground (<span class="math notranslate nohighlight">\(0~\text{V}\)</span>) for this circuit. To find the current through the resistor we simply divide this voltage by the resistance.</p>
<div class="math notranslate nohighlight">
\[
I_O=\frac{V_B-0}{R_2}=\frac{V_B}{R_2}=\frac{14.4~\text{V}}{4~\Omega}=3.6~\text{A}
\]</div>
</div>
</div>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(V_O\)</span> using Nodal Analysis.</p>
<figure class="align-default" id="label-for-this-image6">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>Begin by locating the non-reference nodes and labeling the current directions through the passive components.</p>
<figure class="align-default" id="label-for-this-image7">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p>We will now write a KCL equation for each non-reference node.
<strong>KCL for Node A</strong></p>
<div class="math notranslate nohighlight">
\[
I_{S1}-I_{R1}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
I_{S1}-\frac{V_A-V_B}{R_1}=0
\]</div>
<p>A bit of algebra give us an equation with values and unknown know voltages; suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
-\frac{V_A}{R_1}+\frac{V_B}{R_1}=-I_{S1}
\]</div>
<p>or with values</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{4k}V_A+\frac{1}{4k}V_B=-2~\text{mA}
\]</div>
<p><strong>KCL for Node B</strong></p>
<div class="math notranslate nohighlight">
\[
I_{R1}-I_{R2}-I_{R3}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_B}{R_1}-\frac{V_B-0}{R_2}-\frac{V_B-V_C}{R_3}=0
\]</div>
<p>breaking up the fractions gives us</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A}{R_1}-\frac{V_B}{R_1}-\frac{V_B}{R_2}-\frac{V_B}{R_3}+\frac{V_C}{R_3}=0
\]</div>
<p>Gathering like terms yields</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_1}V_A+\left[-\frac{1}{R_1}-\frac{1}{R_2}-\frac{1}{R_3}\right]V_B+\frac{1}{R_3}V_C=0
\]</div>
<p>Substituting values leads to an equation suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{4k}V_A-\frac{1}{1k}V_B+\frac{1}{4k}V_C=0
\]</div>
<p><strong>KCL for Node C</strong></p>
<div class="math notranslate nohighlight">
\[
I_{R3}-I_{S2}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
\frac{V_B-V_C}{R_3}-I_{S2}=0
\]</div>
<p>breaking up the fractions gives us</p>
<div class="math notranslate nohighlight">
\[
\frac{V_B}{R_3}-\frac{V_C}{R_3}=I_{S2}
\]</div>
<p>Substituting values leads to an equation suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{4k}V_B-\frac{1}{4k}V_C=6~\text{mA}
\]</div>
<p><strong>Solve the System of Equations</strong></p>
<p>Let’s gather the results of the three KCLs written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-5a21bfb5-7528-4390-9c8d-d0fc122bd8ab">
<span class="eqno">(6)<a class="headerlink" href="#equation-5a21bfb5-7528-4390-9c8d-d0fc122bd8ab" title="Permalink to this equation">#</a></span>\[\begin{alignat}{3}
-\frac{1}{4k}V_A+&amp;\frac{1}{4k}V_B&amp;&amp;=-2~\text{mA}\nonumber\\
\frac{1}{4k}V_A-&amp;\frac{1}{1k}V_B+\frac{1}{4k}V_C&amp;&amp;=0\nonumber\\
&amp;\frac{1}{4k}V_B-\frac{1}{4k}V_C&amp;&amp;=6~\text{mA}\nonumber
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrr}
-\frac{1}{4k}&amp;\frac{1}{4k}&amp;0\\
\frac{1}{4k}&amp;-\frac{1}{1k}&amp;\frac{1}{4k}\\
0&amp;\frac{1}{4k}&amp;-\frac{1}{4k}
\end{array} \right]^{-1}\left[\begin{array}{r}-2~\text{mA}\\0\\6~\text{mA}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\end{array}\right]=\left[\begin{array}{r}0~\text{V}\\-8~\text{V}\\-32~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find Other Values</strong></p>
<p>Using the node voltages we can now find other values in the circuit. In this case <span class="math notranslate nohighlight">\(V_O\)</span> is found with</p>
<div class="math notranslate nohighlight">
\[
V_{O}=V_B-V_C=-8-(-32)=24~\text{V}
\]</div>
</div>
</div>
</section>
<section id="nodal-with-voltage-sources">
<h2>Nodal with Voltage Sources<a class="headerlink" href="#nodal-with-voltage-sources" title="Permalink to this headline">#</a></h2>
<p>Just as current sources create special cases for mesh analysis, voltage sources create special cases for Nodal analysis. We will write a KVL for each voltage supply in a circuit we are analyzing with nodal analysis. The rest of the equations in the system will be KCLs. These special cases are divided into two categories: 1) a voltage supply connecting a non-reference node and ground and 2) a voltage supply connecting two non-reference nodes. These next sections describe how to analyze circuits in these two categories using nodal analysis.</p>
<section id="voltage-sources-connected-to-ground">
<h3>Voltage Sources Connected to Ground<a class="headerlink" href="#voltage-sources-connected-to-ground" title="Permalink to this headline">#</a></h3>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(V_O\)</span> and <span class="math notranslate nohighlight">\(I_O\)</span> using Nodal Analysis.</p>
<figure class="align-default" id="label-for-this-image8">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>Begin by locating the non-reference nodes and labeling the current directions through the passive components. This step does not change due to the presence of the voltage supply.</p>
<figure class="align-default" id="label-for-this-image9">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p>The three non-reference node voltages are the unknown and require a system of three equations to find the solution. The presence of <span class="math notranslate nohighlight">\(V_S\)</span> in the circuit leads us to write a KVL for node C. The other two equations will be KCLs written for nodes A and B.</p>
<p>I’ll start with the KVL since it is the equation receiving special treatment in this example. The other two equations are written in a manner similar to the previous examples.</p>
<p><strong>KVL for Node C</strong></p>
<p>I’ve labeled <span class="math notranslate nohighlight">\(V_C\)</span> on the annotated schematic above. I’ll start by writing the KVL as we have in the past. Then I’ll demonstrate a fast way to get the KVL right without having to think about the loop for the KVL.</p>
<p>We start at the ground node and move across <span class="math notranslate nohighlight">\(V_S\)</span>. Next we move across <span class="math notranslate nohighlight">\(V_C\)</span> back to ground. This small loop gives us the KVL equation</p>
<div class="math notranslate nohighlight">
\[
8-V_C=0
\]</div>
<p>We rearrange the equation to have the unknowns on the left and constants on the right as we have before</p>
<div class="math notranslate nohighlight">
\[
V_C=8
\]</div>
<p>This equation is ready for the system of equations. It contains only constants and the unknowns.</p>
<p>Now let’s look at another way to write the equation that will work for any KVL we write during nodal analysis. Anytime there is a voltage supply we can look for the node connected to the positive side of the supply (<span class="math notranslate nohighlight">\(V_C\)</span> in this case) and the node connected to the negative side (ground, or <span class="math notranslate nohighlight">\(0~\text{V}\)</span>, in this case). The node voltages are added together assuming the sign of the voltage polarity is it connected to. The right hand side of the equation is whatever the supply value is labeled as. For this example the equations is</p>
<div class="math notranslate nohighlight">
\[
V_C-0=8
\]</div>
<p>which can be easily simplified to</p>
<div class="math notranslate nohighlight">
\[
V_C=8
\]</div>
<p>the same result as we got above. I like this approach because it will work for any voltage in the circuit. The voltage supply does not need to be connected to ground. The voltage supply could be a dependent source. It works for any labeled voltage in a circuit even if it’s across multiple components.</p>
<p><strong>KCL for Node A</strong></p>
<p>This KCL is straightforward if you are comfortable with the previous examples of nodal analysis.</p>
<div class="math notranslate nohighlight">
\[
I_{S}-I_{R1}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
I_{S1}-\frac{V_A-V_B}{R_1}=0
\]</div>
<p>A bit of algebra give us an equation with values and unknown know voltages; suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
-\frac{V_A}{R_1}+\frac{V_B}{R_1}=-I_{S1}
\]</div>
<p>or with values</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{6}V_A+\frac{1}{6}V_B=-\frac{2}{3}~\text{A}
\]</div>
<p><strong>KCL for Node B</strong></p>
<div class="math notranslate nohighlight">
\[
I_{R1}-I_{R2}-I_{R3}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_B}{R_1}-\frac{V_B-0}{R_2}-\frac{V_B-V_C}{R_3}=0
\]</div>
<p>breaking up the fractions gives us</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A}{R_1}-\frac{V_B}{R_1}-\frac{V_B}{R_2}-\frac{V_B}{R_3}+\frac{V_C}{R_3}=0
\]</div>
<p>Gathering like terms yields</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_1}V_A+\left[-\frac{1}{R_1}-\frac{1}{R_2}-\frac{1}{R_3}\right]V_B+\frac{1}{R_3}V_C=0
\]</div>
<p>Substituting values leads to an equation suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{6}V_A-\frac{1}{3}V_B+\frac{1}{12}V_C=0
\]</div>
<p><strong>Solve the System of Equations</strong></p>
<p>Let’s gather the results of the three equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-1f11ef49-d7a7-4306-bf27-2c30029a9b3a">
<span class="eqno">(7)<a class="headerlink" href="#equation-1f11ef49-d7a7-4306-bf27-2c30029a9b3a" title="Permalink to this equation">#</a></span>\[\begin{alignat}{3}
&amp;&amp;V_C&amp;=8~\text{V}\nonumber\\
-\frac{1}{6}V_A+&amp;\frac{1}{6}V_B&amp;&amp;=-\frac{2}{3}~\text{A}\nonumber\\
\frac{1}{6}V_A-&amp;\frac{1}{3}V_B+&amp;\frac{1}{12}V_C&amp;=0~\text{A}\nonumber
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrr}
0&amp;0&amp;1\\
-\frac{1}{6}&amp;\frac{1}{6}&amp;0\\
\frac{1}{6}&amp;-\frac{1}{3}&amp;\frac{1}{12}
\end{array} \right]^{-1}\left[\begin{array}{r}8~\text{V}\\-\frac{2}{3}~\text{A}\\0~\text{A}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\end{array}\right]=\left[\begin{array}{r}12~\text{V}\\8~\text{V}\\8~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find Other Values</strong></p>
<p>Using the node voltages we can now find other values in the circuit. In this case <span class="math notranslate nohighlight">\(V_O\)</span> is found with</p>
<div class="math notranslate nohighlight">
\[
V_{O}=V_B-V_C=8-8=0~\text{V}
\]</div>
<p>and <span class="math notranslate nohighlight">\(I_O\)</span> is found with</p>
<div class="math notranslate nohighlight">
\[
I_{O}=\frac{V_B-0}{12}=\frac{2}{3}~\text{A}
\]</div>
</div>
</div>
</section>
<section id="voltage-sources-connected-to-two-non-ground-nodes">
<h3>Voltage Sources Connected to Two Non-ground Nodes<a class="headerlink" href="#voltage-sources-connected-to-two-non-ground-nodes" title="Permalink to this headline">#</a></h3>
<p>When a voltage supply connects two non-reference nodes we call it a “supernode”. We treat the voltage supply in a similar manner as the previous example. We write a KVL that includes that voltage supply. The problem we face is then writing a sufficient number of KCL equations to complete the system. Kirchhoff’s Current law can be stated more broadly to address this problem. Rather than stating that the algebraic sum of current entering a <strong>node</strong> is zero, we say that the algebraic sum of currents entering a <strong>bounded region</strong> is zero. Therefore, we can draw the bounded region around the voltage supply including the two nodes it connects to and write a KCL for this “super node”. Let’s look at an example.</p>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(I_O\)</span> using nodal analysis</p>
<figure class="align-default" id="label-for-this-image10">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>We start by looking for non-reference nodes and labeling current directions as before. I’ll also draw the bounded region that forms the super node.</p>
<figure class="align-default" id="label-for-this-image11">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p>The circuit has four non-reference nodes meaning we will write four equations. We write one KVL since there is one voltage source. The rest of the equations, three in this case, are KCLs. Since there is a super node in this circuit one of the KCLs will be written for that super node.</p>
<p><strong>KVL for <span class="math notranslate nohighlight">\(V_S\)</span></strong></p>
<p>Let’s start with the KVL equation. We write this KVL in a similar manner to the previous example. Here are the questions I ask myself when writing a KVL in this context:</p>
<ul class="simple">
<li><p>Which node is connected to the <strong>positive</strong> side of the source? <strong>Node B</strong></p></li>
<li><p>Which node is connected to the <strong>negative</strong> side of the source? <strong>Node C</strong></p></li>
<li><p>What is the voltage source value? <span class="math notranslate nohighlight">\(8~\text{V}\)</span></p></li>
</ul>
<p>The answers given are specific to this example but the questions are common for all KVLs written during nodal analysis. This leads to the KVL equation</p>
<div class="math notranslate nohighlight">
\[
V_B-V_C=8
\]</div>
<p><strong>KCL for Super-node (B and C)</strong></p>
<p>This is the equation in the example that is a little different from what we’ve done previously. Look at the bounded region in the annotated schematic above. How many currents flow in or out of that region? All four currents will be included in the KCL</p>
<div class="math notranslate nohighlight">
\[
I_{R2}-I_{R3}-I_{R4}-I_{R5}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_B}{R_2}-\frac{V_B-0}{R_3}-\frac{V_C-0}{R_4}-\frac{V_C-V_D}{R_5}=0
\]</div>
<p>breaking up the fractions gives us</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A}{R_2}-\frac{V_B}{R_2}-\frac{V_B}{R_3}-\frac{V_C}{R_4}-\frac{V_C}{R_5}+\frac{V_D}{R_5}=0
\]</div>
<p>Gathering like terms yields</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_2}V_A+\left[-\frac{1}{R_2}-\frac{1}{R_3}\right]V_B+\left[-\frac{1}{R_4}-\frac{1}{R_5}\right]V_C+\frac{1}{R_5}V_D=0
\]</div>
<p>Substituting values leads to an equation suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{6}V_A-\frac{1}{4}V_B-\frac{3}{8}V_C+\frac{1}{8}V_D=0
\]</div>
<p><strong>KCL for Node A</strong></p>
<p>The next two equations are straightforward if you are comfortable with the previous examples of nodal analysis.</p>
<div class="math notranslate nohighlight">
\[
-I_{R1}-I_{R2}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
-\frac{V_A-0}{R_1}-\frac{V_A-V_B}{R_2}=0
\]</div>
<p>A bit of algebra give us an equation with values and unknown know voltages; suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\left[-\frac{1}{R_1}-\frac{1}{R_2}\right]V_A+\frac{V_B}{R_2}=0
\]</div>
<p>or with values</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{2}V_A+\frac{1}{6}V_B=0
\]</div>
<p><strong>KCL for Node D</strong></p>
<p>Last one!</p>
<div class="math notranslate nohighlight">
\[
I_{R5}-I_{R6}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
\frac{V_C-V_D}{R_5}-\frac{V_D-0}{R_6}=0
\]</div>
<p>A bit of algebra give us an equation with values and unknown know voltages; suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\frac{V_C}{R_5}+\left[-\frac{1}{R_5}-\frac{1}{R_6}\right]V_D=0
\]</div>
<p>or with values</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{8}V_C-\frac{13}{40}V_D=0
\]</div>
<p><strong>Solve the System of Equations</strong></p>
<p>Let’s gather the results of the four equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-73ed61a5-60bd-4a92-a6cd-749ee5c4acfb">
<span class="eqno">(8)<a class="headerlink" href="#equation-73ed61a5-60bd-4a92-a6cd-749ee5c4acfb" title="Permalink to this equation">#</a></span>\[\begin{alignat}{4}
~&amp;~~\text{V}_B-&amp;~\text{V}_C~~&amp;~&amp;=8\nonumber\\
\frac{1}{6}V_A-&amp;\frac{1}{4}V_B-&amp;\frac{3}{8}V_C+&amp;\frac{1}{8}V_D&amp;=0\nonumber\\
-\frac{1}{2}V_A+&amp;\frac{1}{6}V_B&amp;~&amp;~&amp;=0\nonumber\\
&amp;&amp;\frac{1}{8}V_C-&amp;\frac{13}{40}V_D&amp;=0\nonumber
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrrr}
0&amp;1&amp;-1&amp;0\\
\frac{1}{6}&amp;-\frac{1}{4}&amp;-\frac{3}{8}&amp;\frac{1}{8}\\
-\frac{1}{2}&amp;\frac{1}{6}&amp;0&amp;0\\
0&amp;0&amp;\frac{1}{8}&amp;-\frac{13}{40}\\
\end{array} \right]^{-1}\left[\begin{array}{r}8\\0\\0\\0\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\\V_D\end{array}\right]=\left[\begin{array}{r}1.67~\text{V}\\5.02~\text{V}\\-2.98~\text{V}\\-1.15~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find Other Values</strong></p>
<p>Now that we have the node voltages we can go find other values in the circuit. I chose <span class="math notranslate nohighlight">\(I_O\)</span> through the voltage supply as we have not treated this type of value yet. The typical approach of using Ohm’s law by finding the difference in node voltages and dividing by the resistance will not work here since we don’t know the resistance of the voltage source. Since ohm’s law will not work to find a current we’ll rely on the other fundamental law that involves currents, KCL. We’ll pick a node adjacent to <span class="math notranslate nohighlight">\(I_O\)</span>. We’ll use node C, but node B would work just as well. Here is the KCL at node C including the term for <span class="math notranslate nohighlight">\(I_O\)</span>.</p>
<div class="math notranslate nohighlight">
\[
I_O-I_{R4}-I_{R5}=0
\]</div>
<p>Now we use Ohm’s law in a similar manner as previously, however, the node voltages are no longer unknowns.</p>
<div class="math notranslate nohighlight">
\[
I_O-\frac{V_C-0}{R_4}-\frac{V_C-V_D}{R_5}=0
\]</div>
<p>Now we solve for <span class="math notranslate nohighlight">\(I_O\)</span> and substitute the known values</p>
<div class="math notranslate nohighlight">
\[
I_O=\frac{-2.98}{4}+\frac{-2.98-(-1.15)}{8}=-975.4~\text{mA}
\]</div>
</div>
</div>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(V_O\)</span> using nodal analysis</p>
<figure class="align-default" id="label-for-this-image12">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>When I us this example in class there is a gotcha moment for about half the students. Count how many non-reference nodes before I label them in the next figure. If you said three, you’re not alone. Many students miss the node in between <span class="math notranslate nohighlight">\(V_S\)</span> and <span class="math notranslate nohighlight">\(R_4\)</span>. There are, in fact, four non-reference nodes. I’ll label them below along with the usual notations. There is also a voltage supply leading us to write a KVL for one equation instead of
a KCL. Lastly, that voltage supply connects two non-reference nodes forming a super-node. One of the KCL equations will be written for the bounded region that encloses the two nodes connect to the voltage supply.</p>
<p>Here is the schematic as I would annotate it prior to writing the system of equations for analysis</p>
<figure class="align-default" id="label-for-this-image13">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>KVL for <span class="math notranslate nohighlight">\(V_S\)</span></strong></p>
<p>Here are the questions I ask myself when writing a KVL in this context:</p>
<ul class="simple">
<li><p>Which node is connected to the <strong>positive</strong> side of the source? <strong>Node B</strong></p></li>
<li><p>Which node is connected to the <strong>negative</strong> side of the source? <strong>Node C</strong></p></li>
<li><p>What is the voltage source value? <span class="math notranslate nohighlight">\(8~\text{V}\)</span></p></li>
</ul>
<p>The answers given are specific to this example but the questions are common for all KVLs written during nodal analysis. This leads to the KVL equation</p>
<div class="math notranslate nohighlight">
\[
V_B-V_C=8
\]</div>
<p><strong>KCL for Super-node (B and C)</strong></p>
<p>Look at the bounded region in the annotated schematic above. How many currents flow in or out of that region? All three currents will be included in the KCL</p>
<div class="math notranslate nohighlight">
\[
I_{R2}-I_{R3}-I_{R4}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_B}{R_2}-\frac{V_B-0}{R_3}-\frac{V_C-V_D}{R_4}=0
\]</div>
<p>breaking up the fractions gives us</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A}{R_2}-\frac{V_B}{R_2}-\frac{V_B}{R_3}-\frac{V_C}{R_4}+\frac{V_D}{R_4}=0
\]</div>
<p>Gathering like terms yields</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_2}V_A+\left[-\frac{1}{R_2}-\frac{1}{R_3}\right]V_B-\frac{1}{R_4}V_C+\frac{1}{R_4}V_D=0
\]</div>
<p>Substituting values leads to an equation suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{6}V_A-\frac{1}{4}V_B-\frac{1}{8}V_C+\frac{1}{8}V_D=0
\]</div>
<p><strong>KCL for Node A</strong></p>
<p>The next two equations are straightforward if you are comfortable with the previous examples of nodal analysis.</p>
<div class="math notranslate nohighlight">
\[
-I_{R1}-I_{R2}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
-\frac{V_A-0}{R_1}-\frac{V_A-V_B}{R_2}=0
\]</div>
<p>A bit of algebra give us an equation with values and unknown know voltages; suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\left[-\frac{1}{R_1}-\frac{1}{R_2}\right]V_A+\frac{V_B}{R_2}=0
\]</div>
<p>or with values</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{2}V_A+\frac{1}{6}V_B=0
\]</div>
<p><strong>KCL for Node D</strong></p>
<p>Last one!</p>
<div class="math notranslate nohighlight">
\[
I_{R5}-I_{R6}=0
\]</div>
<p>and use Ohm’s law where we can to rewrite the currents in terms of the node voltages</p>
<div class="math notranslate nohighlight">
\[
\frac{V_C-V_D}{R_5}-\frac{V_D-0}{R_6}=0
\]</div>
<p>A bit of algebra give us an equation with values and unknown know voltages; suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\frac{V_C}{R_5}+\left[-\frac{1}{R_5}-\frac{1}{R_6}\right]V_D=0
\]</div>
<p>or with values</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{8}V_C-\frac{13}{40}V_D=0
\]</div>
<p><strong>Solve the System of Equations</strong></p>
<p>Let’s gather the results of the four equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-e76d5eb2-5c44-441c-b2c8-993763b15b7f">
<span class="eqno">(9)<a class="headerlink" href="#equation-e76d5eb2-5c44-441c-b2c8-993763b15b7f" title="Permalink to this equation">#</a></span>\[\begin{alignat}{4}
~&amp;~~\text{V}_B-&amp;~\text{V}_C~~&amp;~&amp;=8\nonumber\\
\frac{1}{6}V_A-&amp;\frac{1}{4}V_B-&amp;\frac{1}{8}V_C+&amp;\frac{1}{8}V_D&amp;=0\nonumber\\
-\frac{1}{2}V_A+&amp;\frac{1}{6}V_B&amp;~&amp;~&amp;=0\nonumber\\
&amp;&amp;\frac{1}{8}V_C-&amp;\frac{13}{40}V_D&amp;=0\nonumber
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrrr}
0&amp;1&amp;-1&amp;0\\
\frac{1}{6}&amp;-\frac{1}{4}&amp;-\frac{1}{8}&amp;\frac{1}{8}\\
-\frac{1}{2}&amp;\frac{1}{6}&amp;0&amp;0\\
0&amp;0&amp;\frac{1}{8}&amp;-\frac{13}{40}\\
\end{array} \right]^{-1}\left[\begin{array}{r}8\\0\\0\\0\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\\V_D\end{array}\right]=\left[\begin{array}{r}755.9~\text{mV}\\2.268~\text{V}\\-5.732~\text{V}\\-2.205~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find Other Values</strong></p>
<p>Now that we have the node voltages we can go find other values in the circuit. If that value is a voltage look for the node on the positive side of the voltage, <span class="math notranslate nohighlight">\(V_C\)</span> in this case. Subtract from that the node voltage on the negative side, ground in this case. Here it is as an equation</p>
<div class="math notranslate nohighlight">
\[
V_O=V_C-0=-5.732-0=-5.732~\text{V}
\]</div>
<p>The negative side won’t always be connected to ground as it is here. In that case the second term will be non-zero but the form of the equation does not change.</p>
</div>
</div>
</section>
<section id="nodal-analysis-with-dependent-supplies">
<h3>Nodal Analysis with Dependent Supplies<a class="headerlink" href="#nodal-analysis-with-dependent-supplies" title="Permalink to this headline">#</a></h3>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(I_O\)</span> using nodal analysis.</p>
<figure class="align-default" id="label-for-this-image14">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>There are no voltage supplies in this circuit so all of the equations will be KCL equations. There are three non-reference nodes so there will be three KCL equations. The difference in this problem is the presence of the dependent current source <span class="math notranslate nohighlight">\(I_{S2}\)</span>. We’ll write an expression for the control variable, <span class="math notranslate nohighlight">\(I_O\)</span> in this case. Here is the annotated schematic:</p>
<figure class="align-default" id="label-for-this-image15">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>Control Variable Expression</strong></p>
<p>We’ll need this expression to relate the control variable to the unknown node voltages. Our goal when writing the system equations is to have equations that are comprised of constants and the unknown variables. The presence of a control variable in the system is address by substituting with this expression.</p>
<p>This expression is always written using the direction indicated on the schematic, not with your chosen direction during annotation of the schematic. In this case, <span class="math notranslate nohighlight">\(V_A\)</span> is at the tail of the arrow, ground (<span class="math notranslate nohighlight">\(0~\text{V}\)</span>) is at the tip, and the current flows through <span class="math notranslate nohighlight">\(R_1\)</span>.</p>
<div class="math notranslate nohighlight">
\[
I_O=\frac{V_A-0}{R_1}=\frac{V_A}{R_1}
\]</div>
<p><strong>KCL for Node A</strong></p>
<p>The KCL equation for node A is similar to previous examples since it does not involve the dependent supply. We start with the three currents entering or leaving that node</p>
<div class="math notranslate nohighlight">
\[
-I_{R1}-I_{S1}-I_{R4}=0
\]</div>
<p>Use KVL and Ohm’s law to rewrite the equation in terms of the unknown node voltages</p>
<div class="math notranslate nohighlight">
\[
-\frac{V_A-0}{R_1}-I_{S1}-\frac{V_A-V_C}{R_4}=0
\]</div>
<p>A bit of algebra give us an equation with values and unknown know voltages; suitable for inclusion in the system of equations</p>
<div class="math notranslate nohighlight">
\[
\left[-\frac{1}{R_1}-\frac{1}{R_4}\right]V_A+\frac{V_C}{R_4}=I_{S1}
\]</div>
<p>or with values</p>
<div class="math notranslate nohighlight">
\[
-\frac{9}{8}V_A+V_C=4~\text{A}
\]</div>
<p><strong>KCL for Node B</strong></p>
<p>Node B involves the dependent supply so we will use the expression for the control variable we wrote earlier. Other than that substitution, we approach the KCL equation in the same manner. We start with the three currents entering or leaving the node</p>
<div class="math notranslate nohighlight">
\[
I_{S1}-I_{R2}-I_{S2}=0
\]</div>
<p>Use KVL and Ohm’s law to rewrite the equation in terms of the unknown node voltages. I’ve also replaced <span class="math notranslate nohighlight">\(I_{S2}\)</span> with the gain and control variable for that supply</p>
<div class="math notranslate nohighlight">
\[
I_{S1}-\frac{V_B-0}{R_2}-2I_{O}=0
\]</div>
<p>We need to get rid of the control variable. To do so, we substitute the expression for the control variable in terms of the unknown node voltages</p>
<div class="math notranslate nohighlight">
\[
I_{S1}-\frac{V_B-0}{R_2}-2\left[\frac{V_A}{R_1}\right]=0
\]</div>
<p>Now that we have an equation comprised only of constants and unknown node voltages we can do some algebra to group like terms</p>
<div class="math notranslate nohighlight">
\[
-\frac{2}{R_1}V_A-\frac{V_B}{R_2}=-I_{S1}
\]</div>
<p>and substitute values</p>
<div class="math notranslate nohighlight">
\[
-\frac{1}{4}V_A-\frac{1}{2}V_B=-4~\text{A}
\]</div>
<p><strong>KCL for Node C</strong></p>
<p>Node B involves the dependent supply so we will use the expression for the control variable we wrote earlier. Other than that substitution, we approach the KCL equation in the same manner. We start with the three currents entering or leaving the node</p>
<div class="math notranslate nohighlight">
\[
I_{R4}+I_{S2}-I_{R3}=0
\]</div>
<p>Use KVL and Ohm’s law to rewrite the equation in terms of the unknown node voltages. I’ve also replaced <span class="math notranslate nohighlight">\(I_{S2}\)</span> with the gain and control variable for that supply</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_C}{R_4}+2I_{O}-\frac{V_C-0}{R_3}=0
\]</div>
<p>We need to get rid of the control variable. To do so, we substitute the expression for the control variable in terms of the unknown node voltages</p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_C}{R_4}+2\left[\frac{V_A}{R_1}\right]-\frac{V_C-0}{R_3}=0
\]</div>
<p>Now that we have an equation comprised only of constants and unknown node voltages we can do some algebra to group like terms</p>
<div class="math notranslate nohighlight">
\[
\left[\frac{1}{R_4}+\frac{2}{R_1}\right]V_A+\left[-\frac{1}{R_3}-\frac{1}{R_4}\right]V_C=0
\]</div>
<p>and substitute values</p>
<div class="math notranslate nohighlight">
\[
\frac{5}{4}V_A-\frac{5}{4}V_C=0
\]</div>
<p><strong>Solve the System of Equations</strong></p>
<p>Let’s gather the results of the three equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-b01c5d66-d597-425b-8b62-1861248e883e">
<span class="eqno">(10)<a class="headerlink" href="#equation-b01c5d66-d597-425b-8b62-1861248e883e" title="Permalink to this equation">#</a></span>\[\begin{alignat}{3}
-\frac{9}{8}V_A&amp;&amp;+V_C&amp;=4~\text{A}\nonumber\\
-\frac{1}{4}V_A&amp;-\frac{1}{2}V_B&amp;&amp;=-4~\text{A}\nonumber\\
\frac{5}{4}V_A&amp;&amp;-\frac{5}{4}V_C&amp;=0~\text{A}\nonumber
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrr}
-\frac{9}{8}&amp;0&amp;1\\
-\frac{1}{4}&amp;-\frac{1}{2}&amp;0\\
\frac{5}{4}&amp;0&amp;-\frac{5}{4}
\end{array} \right]^{-1}\left[\begin{array}{r}4~\text{A}\\-4~\text{A}\\0~\text{A}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\end{array}\right]=\left[\begin{array}{r}-32~\text{V}\\80~\text{V}\\-32~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find Other Values</strong></p>
<p>Since we’re looking for <span class="math notranslate nohighlight">\(I_O\)</span>, an expression we’ve already used in this analysis, we simply use the node voltage values we just calculated in that same expression.</p>
<div class="math notranslate nohighlight">
\[
I_O=\frac{V_A-0}{R_1}=\frac{-32~\text{V}}{8~\Omega}=-4~\text{A}
\]</div>
</div>
</div>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(V_O\)</span> using nodal analysis</p>
<figure class="align-default" id="label-for-this-image16">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<figure class="align-default" id="label-for-this-image17">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>Control Variable Expression</strong></p>
<div class="math notranslate nohighlight">
\[
V_O=V_C-V_B
\]</div>
<p><strong>KCL for node A</strong></p>
<div class="math notranslate nohighlight">
\[
I_{S1}-I_{R1}-I_{R2}-I_{S2}=0
\]</div>
<div class="math notranslate nohighlight">
\[
3V_O-\frac{V_A-0}{R_1}-\frac{V_A-V_B}{R_2}-I_{S2}=0
\]</div>
<div class="math notranslate nohighlight">
\[
3\left(V_C-V_B\right)-\frac{V_A}{10}-\frac{V_A-V_B}{4}-2=0
\]</div>
<div class="math notranslate nohighlight">
\[
\left[-\frac{1}{10}-\frac{1}{4}\right]V_A+\left[-3+\frac{1}{4}\right]V_B+3V_C=2
\]</div>
<div class="math notranslate nohighlight">
\[
-\frac{7}{20}V_A-\frac{11}{4}V_B+3V_C=2
\]</div>
<p><strong>KCL for node B</strong></p>
<div class="math notranslate nohighlight">
\[
I_{R2}-I_{R3}+I_{R4}=0
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_B}{R_2}-\frac{V_B-0}{R_3}+\frac{V_C-V_B}{R_4}=0
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_2}V_A+\left[-\frac{1}{R_2}-\frac{1}{R_3}-\frac{1}{R_4}\right]V_B+\frac{1}{R_4}V_C=0
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{4}V_A+\left[-\frac{1}{4}-\frac{1}{5}-\frac{1}{2}\right]V_B+\frac{1}{2}V_C=0
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{4}V_A-\frac{19}{20}V_B+\frac{1}{2}V_C=0
\]</div>
<p><strong>KCL for node C</strong></p>
<div class="math notranslate nohighlight">
\[
I_{S2}-I_{R4}+I_{S3}=0
\]</div>
<div class="math notranslate nohighlight">
\[
I_{S2}-\frac{V_C-V_B}{R_4}+I_{S3}=0
\]</div>
<div class="math notranslate nohighlight">
\[
2-\frac{V_C-V_B}{2}+4=0
\]</div>
<div class="math notranslate nohighlight">
\[
-\frac{V_C-V_B}{2}=-6
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{2}V_B-\frac{1}{2}V_C=-6
\]</div>
<p><strong>Solve the System of Equations</strong></p>
<p>Let’s gather the results of the three equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-d68f2bfa-299b-494f-9f81-794118fb2929">
<span class="eqno">(11)<a class="headerlink" href="#equation-d68f2bfa-299b-494f-9f81-794118fb2929" title="Permalink to this equation">#</a></span>\[\begin{alignat}{3}
-\frac{7}{20}V_A&amp;-\frac{11}{4}V_B&amp;+3V_C&amp;=2~\text{A}\nonumber\\
\frac{1}{4}V_A&amp;-\frac{19}{20}V_B&amp;+\frac{1}{2}V_C&amp;=0~\text{A}\nonumber\\
&amp;\frac{1}{2}V_B&amp;-\frac{1}{2}V_C&amp;=-6~\text{A}\nonumber%alignment
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrr}
-\frac{7}{20}&amp;-\frac{11}{4}&amp;3\\
\frac{1}{4}&amp;-\frac{19}{20}&amp;\frac{1}{2}\\
0&amp;\frac{1}{2}&amp;-\frac{1}{2}
\end{array} \right]^{-1}\left[\begin{array}{r}2~\text{A}\\0~\text{A}\\-6~\text{A}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\end{array}\right]=\left[\begin{array}{r}176.84~\text{V}\\111.58~\text{V}\\123.58~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find Other Values</strong></p>
<div class="math notranslate nohighlight">
\[
V_O=V_C-V_B=123.58-111.58=12~\text{V}
\]</div>
</div>
</div>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(I_x\)</span> using nodal analysis.</p>
<figure class="align-default" id="label-for-this-image18">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<figure class="align-default" id="label-for-this-image19">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>Control Variable Expression</strong></p>
<div class="math notranslate nohighlight">
\[
I_x=\frac{V_B-V_C}{R_2}
\]</div>
<p><strong>KVL for super-node (A and B)</strong></p>
<div class="math notranslate nohighlight">
\[
V_B-V_A=4I_x
\]</div>
<div class="math notranslate nohighlight">
\[
V_B-V_A=4\frac{V_B-V_C}{R_2}
\]</div>
<div class="math notranslate nohighlight">
\[
V_B-V_A-4\frac{V_B-V_C}{R_2}=0
\]</div>
<div class="math notranslate nohighlight">
\[
-V_A+\left[1-\frac{4}{R_2}\right]V_B+\frac{4}{R_2}V_C=0
\]</div>
<div class="math notranslate nohighlight">
\[
-V_A+\left[1-\frac{4}{12}\right]V_B+\frac{4}{12}V_C=0
\]</div>
<div class="math notranslate nohighlight">
\[
-V_A-\frac{2}{3}V_B+\frac{1}{3}V_C=0
\]</div>
<p><strong>KCL for super-node (A and B)</strong></p>
<div class="math notranslate nohighlight">
\[
I_{R1}-I_{R2}-I_{R3}-I_{R4}=0
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{V_C-V_A}{R_1}-\frac{V_B-V_C}{R_2}-\frac{V_A-0}{R_3}-\frac{V_B-0}{R_4}=0
\]</div>
<div class="math notranslate nohighlight">
\[
\left[-\frac{1}{R_1}-\frac{1}{R_3}\right]V_A+\left[-\frac{1}{R_2}-\frac{1}{R_4}\right]V_B+\left[\frac{1}{R_1}+\frac{1}{R_2}\right]V_C=0
\]</div>
<div class="math notranslate nohighlight">
\[
\left[-\frac{1}{8}-\frac{1}{24}\right]V_A+\left[-\frac{1}{12}-\frac{1}{6}\right]V_B+\left[\frac{1}{8}+\frac{1}{12}\right]V_C=0
\]</div>
<div class="math notranslate nohighlight">
\[
-\frac{1}{6}V_A-\frac{1}{4}V_B+\frac{5}{24}V_C=0
\]</div>
<p><strong>KVL for node C</strong></p>
<div class="math notranslate nohighlight">
\[
V_C-0=V_S
\]</div>
<div class="math notranslate nohighlight">
\[
V_C=15~\text{V}
\]</div>
<p><strong>Solve the System of Equations</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Let&#39;s gather the results of the three equations written above
\begin{alignat}{3}
	-V_A&amp;-\frac{2}{3}V_B&amp;+\frac{1}{3}V_C&amp;=0~\text{A}\nonumber\\
	-\frac{1}{6}V_A&amp;-\frac{1}{4}V_B&amp;+\frac{5}{24}V_C&amp;=0~\text{A}\nonumber\\
	&amp;&amp;V_C&amp;=15~\text{V}\nonumber%alignment
\end{alignat}
and put them in matrix form
</pre></div>
</div>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrr}
    -1&amp;-\frac{2}{3}&amp;\frac{1}{3}\\
    -\frac{1}{6}&amp;-\frac{1}{4}&amp;\frac{5}{24}\\
    0&amp;0&amp;1
    \end{array} \right]^{-1}\left[\begin{array}{r}0~\text{A}\\0~\text{A}\\15~\text{V}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\end{array}\right]=\left[\begin{array}{r}-6~\text{V}\\16.5~\text{V}\\15~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find Other Values</strong></p>
<div class="math notranslate nohighlight">
\[
I_x=\frac{16.5-15}{12}=125~\text{mA}
\]</div>
</div>
</div>
</section>
<section id="nodal-analysis-with-an-ideal-operational-amplifier">
<h3>Nodal Analysis with an Ideal Operational Amplifier<a class="headerlink" href="#nodal-analysis-with-an-ideal-operational-amplifier" title="Permalink to this headline">#</a></h3>
<figure class="align-default" id="label-for-this-image20">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>Assumptions about an ideal op-amp:</strong></p>
<ul class="simple">
<li><p>The voltage at the input nodes are equal (<span class="math notranslate nohighlight">\(V_+ = V_-\)</span>)</p></li>
<li><p>No current enters or leaves the inputs (<span class="math notranslate nohighlight">\(I_+ = I_- = 0\)</span>)</p></li>
</ul>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(V_O\)</span> using nodal analysis</p>
<figure class="align-default" id="label-for-this-image21">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p>This is a circuit that you could easily look up in a book, apply the given equations, and find whatever value you seek. However, if you don’t know where to find such a reference, or if the circuit is altered even slightly, this approach will fail. Instead, we can use the assumptions stated above and our knowledge of nodal analysis to develop a system of equations. We can then solve that system as we have previously to find the node voltages and any other values we need.</p>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<p>The circuit has three non-reference nodes which I will label below. Just as before, the voltage supply leads us to write a KVL equation in place of one of the KCL equations. In a circuit with op-amps we also replace a KCL equation with a KVL for each op-amp. That KVL will reflect the first assumption stated above. Therefore, the system of equations for this analysis will consist of a KVL for the voltage supply, a KVL for the op-amp, and another KCL for one of the nodes.</p>
<p>Let’s start by annotating the circuit just as before. The op-amp is not a passive component and therefore we do not assign it a current direction.</p>
<figure class="align-default" id="label-for-this-image22">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>KVL for Node A</strong></p>
<div class="math notranslate nohighlight">
\[
V_A-0=10~\text{V}
\]</div>
<div class="math notranslate nohighlight">
\[
V_A=10~\text{V}
\]</div>
<p><strong>KVL for Op-amp</strong></p>
<div class="math notranslate nohighlight">
\[
V_B=0~\text{V}
\]</div>
<p><strong>KCL for Node B</strong></p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_B}{3k}-\frac{V_B-V_C}{15k}-0=0
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{3k}V_A+\left[-\frac{1}{3k}-\frac{1}{15k}\right]V_B+\frac{1}{15k}V_C=0
\]</div>
<p><strong>Solve the System</strong></p>
<p>Let’s gather the results of the three equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-05fd52ef-062c-44c4-878b-11fec56d70eb">
<span class="eqno">(12)<a class="headerlink" href="#equation-05fd52ef-062c-44c4-878b-11fec56d70eb" title="Permalink to this equation">#</a></span>\[\begin{alignat}{3}
V_A&amp;&amp;&amp;=10~\text{V}\nonumber\\
~&amp;~~~~~~~\text{V}_B&amp;~&amp;=0~\text{V}\nonumber\\%there has got to be a better way to align this
\frac{1}{3k}V_A&amp;-\frac{6}{15k}&amp;V_B+\frac{1}{15k}V_C&amp;=0~\text{A}\nonumber
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrr}
1&amp;0&amp;0\\
0&amp;1&amp;0\\
\frac{1}{3k}&amp;-\frac{6}{15k}&amp;\frac{1}{15k}
\end{array} \right]^{-1}\left[\begin{array}{r}10~\text{V}\\0~\text{V}\\0~\text{A}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\end{array}\right]=\left[\begin{array}{r}10~\text{V}\\0~\text{V}\\-50~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find other values</strong></p>
<div class="math notranslate nohighlight">
\[
V_O=V_C-0=-50-0=-50~\text{V}
\]</div>
</div>
</div>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<figure class="align-default" id="label-for-this-image23">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<figure class="align-default" id="label-for-this-image24">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>KVL for node A</strong></p>
<div class="math notranslate nohighlight">
\[
V_A-0=10~\text{V}
\]</div>
<div class="math notranslate nohighlight">
\[
V_A=10~\text{V}
\]</div>
<p><strong>KVL for op-amp</strong></p>
<div class="math notranslate nohighlight">
\[
V_A=V_B
\]</div>
<div class="math notranslate nohighlight">
\[
V_A-V_B=0
\]</div>
<p><strong>KCL for node B</strong></p>
<div class="math notranslate nohighlight">
\[
-\frac{V_B-0}{4}-\frac{V_B-V_C}{12}-0=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
\left[-\frac{1}{4}-\frac{1}{12}\right]V_B+\frac{1}{12}V_C=0~\text{A}
\]</div>
<p><strong>Solve the System</strong></p>
<p>Let’s gather the results of the three equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-72459388-0fc6-483d-ae3e-1c3e99c829ae">
<span class="eqno">(13)<a class="headerlink" href="#equation-72459388-0fc6-483d-ae3e-1c3e99c829ae" title="Permalink to this equation">#</a></span>\[\begin{alignat}{3}
V_A&amp;&amp;&amp;=10~\text{V}\nonumber\\
V_A&amp;-V_B&amp;~&amp;=0~\text{V}\nonumber\\%there has got to be a better way to align this
~&amp;-\frac{1}{3}&amp;V_B+\frac{1}{12}V_C&amp;=0~\text{A}\nonumber
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrr}
1&amp;0&amp;0\\
1&amp;-1&amp;0\\
0&amp;-\frac{1}{3}&amp;\frac{1}{12}
\end{array} \right]^{-1}\left[\begin{array}{r}10~\text{V}\\0~\text{V}\\0~\text{A}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\end{array}\right]=\left[\begin{array}{r}10~\text{V}\\0~\text{V}\\40~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find other values</strong></p>
<div class="math notranslate nohighlight">
\[
I_O=\frac{V_C-0}{8}=\frac{40-0}{8}=5~\text{A}
\]</div>
</div>
</div>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<figure class="align-default" id="label-for-this-image25">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<figure class="align-default" id="label-for-this-image26">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>KVL for node A</strong></p>
<div class="math notranslate nohighlight">
\[
V_A-0=2~\text{V}
\]</div>
<div class="math notranslate nohighlight">
\[
V_A=2~\text{V}
\]</div>
<p><strong>KCL for node B</strong></p>
<div class="math notranslate nohighlight">
\[
\frac{V_A-V_B}{R_1}-\frac{V_B-V_C}{R_2}+\frac{V_D-V_B}{R_4}=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_1}V_A+\left[-\frac{1}{R_1}-\frac{1}{R_2}-\frac{1}{R_4}\right]V_B+\frac{1}{R_2}V_C+\frac{1}{R_4}V_D=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{4k}V_A-\frac{83}{140k}V_B+\frac{1}{7k}V_C+\frac{1}{5k}V_D=0~\text{A}
\]</div>
<p><strong>KCL for node C</strong></p>
<div class="math notranslate nohighlight">
\[
\frac{V_B-V_C}{R_2}-\frac{V_C-0}{R_3}+0=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{R_2}V_B+\left[-\frac{1}{R_2}-\frac{1}{R_3}\right]V_C=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{7k}V_B-\frac{17}{70k}V_C=0~\text{A}
\]</div>
<p><strong>KVL for op-amp</strong></p>
<div class="math notranslate nohighlight">
\[
V_C=V_D
\]</div>
<div class="math notranslate nohighlight">
\[
V_C-V_D=0
\]</div>
<p><strong>Solve the System</strong></p>
<p>Let’s gather the results of the four equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-02ed4920-212b-4a0f-8f39-399c7ec484f7">
<span class="eqno">(14)<a class="headerlink" href="#equation-02ed4920-212b-4a0f-8f39-399c7ec484f7" title="Permalink to this equation">#</a></span>\[\begin{alignat}{4}
V_A&amp;&amp;&amp;&amp;=2~\text{V}\nonumber\\
\frac{1}{4k}V_A&amp;-\frac{83}{140k}V_B&amp;+\frac{1}{7k}V_C&amp;+\frac{1}{5k}V_D&amp;=0~\text{A}\nonumber\\%there has got to be a better way to align this
&amp;\frac{1}{7k}V_B&amp;-\frac{17}{70k}V_C&amp;&amp;=0~\text{A}\nonumber\\%there has got to be a better way to align this
&amp;&amp;V_C&amp;-V_D&amp;=0~\text{V}\nonumber\\
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrrr}
1&amp;0&amp;0&amp;0\\
\frac{1}{4k}&amp;-\frac{83}{140k}&amp;\frac{1}{7k}&amp;\frac{1}{5k}\\
0&amp;\frac{1}{7k}&amp;-\frac{17}{70k}&amp;0\\
0&amp;0&amp;1&amp;-1
\end{array} \right]^{-1}\left[\begin{array}{r}2~\text{V}\\0~\text{A}\\0~\text{A}\\0~\text{V}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\\V_D\end{array}\right]=\left[\begin{array}{r}2~\text{V}\\1.278~\text{V}\\751.9~\text{mV}\\751.9~\text{mV}\end{array}\right]
\end{split}\]</div>
<p><strong>Find other values</strong></p>
<div class="math notranslate nohighlight">
\[
I_O-I_{R4}-0=0
\]</div>
<div class="math notranslate nohighlight">
\[
I_O=I_{R4}=\frac{V_D-V_B}{5k}=\frac{751.9~\text{mV}-1.278~\text{V}}{5k}=-105.3~\mu A
\]</div>
<p>How will this change if we connect a load resistor to the output?</p>
</div>
</div>
<div class="admonition-example admonition">
<p class="admonition-title">Example</p>
<p>Find <span class="math notranslate nohighlight">\(I_O\)</span></p>
<figure class="align-default" id="label-for-this-image27">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<div class="tip dropdown admonition">
<p class="admonition-title">Solution</p>
<figure class="align-default" id="label-for-this-image28">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<p><strong>KVL for super-node (A and B)</strong></p>
<div class="math notranslate nohighlight">
\[
V_A-V_B=4~\text{V}
\]</div>
<p><strong>KCL for super-node (A and B)</strong></p>
<div class="math notranslate nohighlight">
\[
-\frac{V_A-0}{6}-\frac{V_B-0}{9}-\frac{V_B-V_C}{18}=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
-\frac{1}{6}V_A+\left[-\frac{1}{9}-\frac{1}{18}\right]V_B+\frac{1}{18}V_C=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
-\frac{1}{6}V_A-\frac{1}{6}V_B+\frac{1}{18}V_C=0~\text{A}
\]</div>
<p><strong>KVL for op-amp</strong></p>
<div class="math notranslate nohighlight">
\[
V_C=0~\text{V}
\]</div>
<p><strong>KCL for node C</strong></p>
<div class="math notranslate nohighlight">
\[
\frac{V_B-V_C}{18}-\frac{V_C-V_D}{72}+0=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{18}V_B+\left[-\frac{1}{18}-\frac{1}{72}\right]V_C+\frac{1}{72}V_D=0~\text{A}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{1}{18}V_B-\frac{5}{72}V_C+\frac{1}{72}V_D=0~\text{A}
\]</div>
<p><strong>Solve the system</strong></p>
<p>Let’s gather the results of the four equations written above</p>
<div class="amsmath math notranslate nohighlight" id="equation-714a5f15-723f-47f5-baea-efd755d4f6d4">
<span class="eqno">(15)<a class="headerlink" href="#equation-714a5f15-723f-47f5-baea-efd755d4f6d4" title="Permalink to this equation">#</a></span>\[\begin{alignat}{4}
V_A&amp;~-V_B&amp;&amp;&amp;=4~\text{V}\nonumber\\
-\frac{1}{6}V_A&amp;-\frac{1}{6}V_B&amp;+\frac{1}{18}V_C&amp;&amp;=0~\text{A}\nonumber\\%there has got to be a better way to align this
&amp;&amp;V_C&amp;&amp;=0~\text{V}\nonumber\\
&amp;\frac{1}{18}V_B&amp;-\frac{5}{72}V_C&amp;+\frac{1}{72}V_D&amp;=0~\text{A}\nonumber
\end{alignat}\]</div>
<p>and put them in matrix form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
 \left[ \begin{array}{rrrr}
1&amp;-1&amp;0&amp;0\\
-\frac{1}{6}&amp;-\frac{1}{6}&amp;\frac{1}{18}&amp;0\\
0&amp;0&amp;1&amp;0\\
0&amp;\frac{1}{18}&amp;-\frac{5}{72}&amp;\frac{1}{72}
\end{array} \right]^{-1}\left[\begin{array}{r}4~\text{V}\\0~\text{A}\\0~\text{V}\\0~\text{A}\end{array}\right]=\left[\begin{array}{c}V_A\\V_B\\V_C\\V_D\end{array}\right]=\left[\begin{array}{r}2~\text{V}\\-2~\text{V}\\0~\text{V}\\8~\text{V}\end{array}\right]
\end{split}\]</div>
<p><strong>Find other values</strong></p>
<div class="math notranslate nohighlight">
\[
\frac{V_C-V_D}{72}+I_O-\frac{V_D-0}{12}=0
\]</div>
<div class="math notranslate nohighlight">
\[
I_O=-\frac{0-8}{72}+\frac{8-0}{12}=\frac{7}{9}~\text{A}=777.8~\text{mA}
\]</div>
</div>
</div>
</section>
</section>
<section id="the-shortcut">
<h2>The Shortcut<a class="headerlink" href="#the-shortcut" title="Permalink to this headline">#</a></h2>
<figure class="align-default" id="label-for-this-image29">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image30">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image31">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image32">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image33">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image34">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image35">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image36">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image37">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image38">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
<figure class="align-default" id="label-for-this-image39">
<a class="reference internal image-reference" href="_images/logo.png"><img alt="_images/logo.png" src="_images/logo.png" style="height: 300px;" /></a>
</figure>
</section>
<section id="strategy-for-nodal-analysis">
<h2>Strategy for Nodal Analysis<a class="headerlink" href="#strategy-for-nodal-analysis" title="Permalink to this headline">#</a></h2>
<p>The examples I’ve worked are intended to teach you how to deal with the little oddities that arise when performing nodal analysis. If you master these you will be able to analyze any linear electric circuits. I’ve also shown you how to use the “shortcut” to perform nodal analysis quickly. With practice you may be able to analyze most circuits simply by looking at the circuit and using your calculator to build the system of equations.</p>
<p>Not all circuits require you to use the techniques introduced here. When I first begin analysis of a circuit I look for certain conditions and I make a plan to deal with them. I will do my best to summarize the strategy I use when analyzing a circuit.</p>
<ol class="simple">
<li><p><strong>How many non-reference nodes?</strong> Non-reference nodes are any nodes that are not the ground node. The number of non-reference nodes define how many unknowns will be part of the system and, therefore, how many equations you will have to write.</p></li>
<li><p><strong>Are there voltage supplies?</strong> Each voltage supply means you will write a KVL equation instead of a KCL. Also notice I say “voltage supply”. I don’t say “dependent supply” or “independent supply” since the type of voltage supply does not matter. \begin{enumerate} 1. <strong>Is the voltage supply grounded on one side?</strong> This is the simpler of the two conditions created by voltage supplies in the circuit. Just write a KVL for the voltage supply and skip the KCL for the node connected to the other side of the voltage supply. 1. <strong>Does the voltage supply connected to two non-reference nodes?</strong> This condition creates a “super-node”. The KVL is written in the same way as the previous case. The difference here is found in how you will write one of the KCLs. Rather than writing a KCL for a single node you will write a KCL for the region that bounds the two nodes on either side of the voltage supply.</p></li>
<li><p><strong>Are there any operational amplifiers?</strong> We use the two assumptions about ideal op-amps to complete the system of equations in this case. The first is that the voltages on the <strong>inputs</strong> of the op-amp are equal. This is included in the system as a KVL equation. This KVL replaces one of the KCL equations needed to complete the system. You’ll still need to write enough KCL equations to complete the system. Find nodes that are not connected to 1) voltage supplies and 2) the <strong>output</strong> of the op-amp. Nodes connected to the inputs of the op-amp are fair game since we assume no current enters or leaves those inputs.</p></li>
<li><p><strong>Are there any dependent supplies?</strong> Look for diamond shaped supplies. It does not matter whether they are voltage or current supplies. Locate the control variable on the schematic and write an expression for it in terms of the unknown mesh currents. This expression is written in a similar manner to finding the output values of the analysis. You should use this expression anytime the control variable shows up in the system of equations.</p></li>
<li><p><strong>Write the equations</strong> If you’ve answered the questions above you should know which equations you will include in the system. Write them carefully and use good practice with regards to the signs and order of coefficients.</p></li>
<li><p><strong>Solve the system</strong> Matrix inversion works. So does row-reduced echelon form. If you’d like use software like MATLAB to solve the system. Just find the answer.</p></li>
<li><p><strong>Find output of analysis</strong> Once you know the node voltages you can find any other value in the circuit. The output of the analysis may take a few different forms.</p></li>
<li><p><strong>Is the value a voltage?</strong> If the value is a voltage start with the node voltage on the positive side of the output. Subtract the node voltage on the negative side of the output.</p></li>
<li><p><strong>Is the value a current through a single passive component?</strong> If the value is a current through a passive component use a combination of KVL and Ohm’s law to find that voltage. Find the voltage as you did for the previous output type respecting passive sign convention for the labeled current direction. Use that voltage and the resistance (or impedance in later chapters) to find the current . This is useful for finding currents that are outputs of the analysis as well as finding currents that are intermediate values for the next type of output value.</p></li>
<li><p><strong>Is the value a current through a voltage supply or op-amp output?</strong> If the value is a current through one of these components you can find it using a KCL at a node connected to the component. This means you have to find other currents using the previous method. Write a KCL at a node that includes the unknown current. Find all of the other currents entering/leaving the node. Solve for the unknown current.</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="chapter-7.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Mesh Analysis</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="chapter-9.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Superposition</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By David J. Broderick &amp; Peter J. Kootsookos<br/>
  
      &copy; Copyright 2023.<br/>
    <div class="extra_footer">
      <p xmlns:cc="http://creativecommons.org/ns#" xmlns:dct="http://purl.org/dc/terms/"><a property="dct:title" rel="cc:attributionURL" href="https://circuit-analysis.github.io">Circuit Analysis</a> by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://github.com/djbrod">David J. Broderick</a> and <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="https://github.com/kootsoop">Peter J. Kootsookos</a> is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-SA 4.0<img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1"></a></p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>